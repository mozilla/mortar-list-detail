/* Zepto v1.0rc1 - polyfill zepto event detect fx ajax form touch - zeptojs.com/license */

//     Underscore.js 1.4.1
//     http://underscorejs.org
//     (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Underscore may be freely distributed under the MIT license.

//     (c) 2010-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

(function(e){function r(e,t){if(t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}function i(e,t){if(e.forEach){e.forEach(t);return}for(var n in e)e.hasOwnProperty(n)&&t(e[n])}function s(e,t){if(e.indexOf)return e.indexOf(t);for(var n in e)if(e[n]==t)return n;return-1}function u(e){if(this===window||typeof mozmarket!="undefined"&&this==mozmarket.receipts)return new u(e);e=e||{},this.overlay=null;for(var t in e)if(e.hasOwnProperty(t)&&t!="verifier"&&t!="templates"&&t!="verify"&&t!="verifierOptions"){if(this[t]===undefined)throw"Unknown option: "+t;this[t]=e[t]}if(e.templates){var r=this.templates;this.templates={};for(var t in r)this.templates[t]=r[t];for(var t in e.templates)e.templates.hasOwnProperty(t)&&(this.templates[t]=e.templates[t])}if(!this.storeURL)throw"You must provide a storeURL option";if(!this.supportHTML)throw"You must provide a supportHTML option";e.verifier&&this.respond(e.verifier);if(e.verify){var i=new n(e.verifierOptions),s=this;i.verify(function(){s.respond(i)})}}e.receipts||(e.receipts={});var t=function(){return this}();typeof atob=="undefined"&&typeof Buffer!="undefined"&&(atob=function(e){return(new Buffer(e,"base64")).toString("utf8")});var n=function(e){if(this===t)throw"You forgot new";e=e||{};for(var n in e)if(e.hasOwnProperty(n)&&this._validConstructorArguments.indexOf(n)==-1)throw"Illegal option to Verifier({}): "+n;this.app=undefined,this.products=[],this.receiptErrors={},this.receiptVerifications={},this._cacheStorage=e.cacheStorage||(typeof localStorage!="undefined"?localStorage:undefined),this.cacheTimeout=e.cacheTimeout||this.defaultCacheTimeout,this.state=new this.states.VerificationIncomplete(".verify() has not been called"),this.requestTimeout=e.requestTimeout||this.defaultRequestTimeout,this.refundWindow=e.refundWindow||this.defaultRefundWindow,this.installs_allowed_from=e.installs_allowed_from||undefined,this.onlog=e.onlog,e.logLevel&&(typeof e.logLevel=="string"?this.logLevel=this.levels[e.logLevel]:this.logLevel=e.logLevel)};n.State=function(e,i){if(e===undefined)return this;var s=function(e,n){if(this===t)throw"You forgot new";this.detail=e,r(this,n)};return i===undefined&&(i=n.State),s.prototype=new i,s.className=e,s.prototype.name=e,s},n.State.prototype.toString=function(){var e="["+this.name;this.detail&&(e+=" "+this.detail);for(var t in this)if(this.hasOwnProperty(t)&&t!="detail"){if(typeof this[t]=="object"&&this[t]&&this[t].toSource)var n=this[t].toSource();else var n=JSON.stringify(this[t]);e+=" "+t+": "+n}return e+="]",e},n.states={},n.states.VerificationIncomplete=n.State("VerificationIncomplete"),n.states.NeedsInstall=n.State("NeedsInstall"),n.states.MozAppsNotSupported=n.State("MozAppsNotSupported"),n.states.NetworkError=n.State("NetworkError"),n.states.NotInstalled=n.State("NotInstalled",n.states.NeedsInstall),n.states.NoReceipts=n.State("NoReceipts",n.states.NeedsInstall),n.states.NoValidReceipts=n.State("NoValidReceipts"),n.states.OK=n.State("OK"),n.states.OKCache=n.State("OKCache",n.states.OK),n.states.OKStaleCache=n.State("OKStaleCache",n.states.OKCache),n.states.InternalError=n.State("InternalError"),n.states.MozAppsError=n.State("MozAppsError",n.states.InternalError),n.states.VerifierError=n.State("VerifierError",n.states.InternalError),n.states.ServerError=n.State("ServerError",n.states.NetworkError),n.states.toString=function(){var e=[];for(var t in this)this.hasOwnProperty(t)&&t!="toString"&&t!="detail"&&e.push(t);return e.sort(),"{"+e.join(", ")+"}"},n.errors={},n.errors.ReceiptFormatError=n.State("ReceiptFormatError"),n.errors.ReceiptParseError=n.State("ReceiptParseError",n.errors.ReceiptFormatError),n.errors.InvalidFromStore=n.State("InvalidFromStore"),n.errors.Refunded=n.State("Refunded"),n.errors.RequestTimeout=n.State("RequestTimeout",n.states.ServerError),n.errors.ServerStatusError=n.State("ServerStatusError",n.states.ServerError),n.errors.InvalidServerResponse=n.State("InvalidServerResponse",n.states.ServerError),n.errors.InvalidReceiptIssuer=n.State("InvalidReceiptIssuer"),n.errors.ConnectionError=n.State("ConnectionError",n.states.NetworkError),n.errors.ReceiptExpired=n.State("ReceiptExpired"),n.errors.toString=n.states.toString,n.prototype={_validConstructorArguments:["cacheStorage","cacheTimeout","requestTimeout","refundWindow","installs_allowed_from","onlog","logLevel"],defaultCacheTimeout:864e5,defaultRequestTimeout:3e4,defaultRefundWindow:24e5,toString:function(){var e=this,t="[Verifier state: "+this.state;return this.products.length&&(t+=" products: "+this.products.map(function(e){return e.url}).join(", ")),this.iterReceiptErrors(function(n,r){r==e.state?t+=" Error("+n.substr(0,4)+"..."+n.substr(n.length-4)+"): [error is state]":t+=" Error("+n.substr(0,4)+"..."+n.substr(n.length-4)+"): "+r}),this.app&&(t+=" installed app: "+this.app.manifestURL),t+="]",t},iterReceiptErrors:function(e){for(var t in this.receiptErrors)if(this.receiptErrors.hasOwnProperty(t)){var n=e(t,this.receiptErrors[t]);if(n===!1)break}},verify:function(e){var t=this;this.state=new this.states.VerificationIncomplete(".verify() has not completed");if(!navigator.mozApps){this.state=new this.states.MozAppsNotSupported("navigator.mozApps does not exist"),e(t);return}var n=navigator.mozApps.getSelf();n.onsuccess=function(){try{t.app=this.result||null;if(!this.result){t.state=new t.states.NotInstalled("The app is not installed"),e(t);return}t.log(t.levels.INFO,"Got application: "+this.result.manifestURL),t.verifyReceipts(this.result,e)}catch(n){t.state=new t.states.VerifierError("Exception: "+n,{exception:n}),e(t)}},n.onerror=function(){t.state=new t.errors.MozAppsError("Error calling mozApps.getSelf: "+(this.error&&this.error.name),{mozAppsError:this.error}),t.log(t.levels.ERROR,"Got mozApps Error: "+(this.error&&this.error.name)),e(t)}},verifyReceipts:function(e,t){if(!e.receipts||!e.receipts.length){e.receipts===undefined&&this.log(r.levels.ERROR,"The .receipts property of the app object is undefined (app: "+JSON.stringify(e)+")"),this.state=new this.states.NoReceipts("No receipts were found or installed");return}this.installs_allowed_from===undefined&&(this.installs_allowed_from=e.manifest.installs_allowed_from,this.log(this.levels.INFO,"Using installs_allowed_from value from manifest: "+JSON.stringify(this.installs_allowed_from)));var n=e.receipts.length,r=this;i(e.receipts,function(i){r.log(r.levels.DEBUG,"Checking receipt "+i.substr(0,4));var s=r._checkCache(i,!1);if(s){r.log(r.levels.INFO,"Got receipt ("+i.substr(0,4)+") status from cache: "+JSON.stringify(s)),r._addReceiptError(i,new r.states.OKCache),r._addReceiptVerification(i,s),n--,n||r._finishVerification(t);return}try{r._verifyOneReceipt(e,i,function(){n--,n||r._finishVerification(t)})}catch(o){r.log(r.levels.ERROR,"Got error in _verifyOneReceipt: "+o),r._addReceiptError(i,new r.states.VerifierError("Exception in _verifyOneReceipt: "+o,{exception:o})),n--,n||r._finishVerification(t)}})},_finishVerification:function(e){try{this.log(this.levels.DEBUG,"Finished all receipt verification"),this.state instanceof this.states.VerificationIncomplete&&(this.log(this.levels.DEBUG,"No serious errors during verification"),this.products.length?this.state=new this.states.OK:this.state=new this.states.NoValidReceipts("No receipts passed verification")),e(this)}catch(t){this.log(this.levels.ERROR,"Fatal error in _finishVerification: "+t),this.state=new this.states.VerifierError("Exception: "+t,{exception:t}),e(this)}},_verifyOneReceipt:function(e,t,n){try{var r=this.parseReceipt(t)}catch(i){this._addReceiptError(t,new this.errors.ReceiptParseError("Error decoding JSON: "+i,{exception:i})),n();return}var o=r.iss;if(!o){this._addReceiptError(t,new this.errors.ReceiptFormatError("No (or empty) iss field"),{parsed:r}),n();return}if(this.installs_allowed_from&&s(this.installs_allowed_from,o)==-1&&s(this.installs_allowed_from,"*")==-1){this._addReceiptError(t,new this.errors.InvalidReceiptIssuer("Issuer (iss) of receipt is not a valid installer: "+o,{iss:o,installs_allowed_from:this.installs_allowed_from})),n();return}var u=r.verify;if(!u){this._addReceiptError(t,new this.errors.ReceiptFormatError("No (or empty) verify field"),{parsed:r}),n();return}typeof XMLHttpRequest=="undefined"&&(XMLHttpRequest=require("xmlhttprequest").XMLHttpRequest);var a=new XMLHttpRequest,f=this,l=null;this.log(this.levels.INFO,"POSTing to "+u),a.open("POST",u),a.onreadystatechange=function(){if(a.readyState!=4)return;f.log(f.levels.INFO,"Request to "+u+" completed with status: "+a.status),l&&(clearTimeout(l),l=null);if(a.status===0){f._addReceiptError(t,new f.errors.ConnectionError("Server could not be contacted",{request:a,url:u})),n();return}if(a.status==404){f._addReceiptError(t,new f.errors.ServerStatusError("Server responded with 404 to "+u,{request:a,status:a.status,url:u})),n();return}if(a.status!=200){f._addReceiptError(t,new f.errors.ServerStatusError("Server responded with non-200 status: "+a.status,{request:a,status:a.status,url:u})),n();return}try{var e=JSON.parse(a.responseText)}catch(i){f._addReceiptError(t,new f.errors.InvalidServerResponse("Invalid JSON from server",{request:a,text:a.responseText})),n();return}if(typeof e!="object"||e===null){f._addReceiptError(t,new f.errors.InvalidServerResponse("Server did not respond with a JSON object ("+JSON.stringify(e)+")",{request:a,text:a.responseText})),n();return}f.log(f.levels.INFO,"Receipt ("+t.substr(0,4)+"...) completed with result: "+JSON.stringify(e));if(e.status=="ok"||e.status=="pending"){f._addReceiptVerification(t,e),e.status=="ok"&&f._saveResults(t,r,e),n();return}if(e.status=="refunded"){f._addReceiptError(t,new f.errors.Refunded("Application payment was refunded",{result:e})),n();return}if(e.status=="expired"){f._addReceiptError(t,new f.errors.ReceiptExpired("Receipt expired",{result:e})),f._addReceiptVerification(t,e),n();return}if(e.status=="invalid"){f._addReceiptError(t,new f.errors.InvalidFromStore("The store reports the receipt is invalid",{result:e})),n();return}f._addReceiptError(t,new f.errors.InvalidServerResponse("Store replied with unknown status: "+e.status,{result:e})),n()},a.send(t),this.requestTimeout&&(l=setTimeout(function(){a.abort(),f.log(f.levels.ERROR,"Request to "+u+" timed out"),f._addReceiptError(t,new f.errors.RequestTimeout("The request timed out after "+f.requestTimeout+" milliseconds",{request:a,url:u})),n()},this.requestTimeout))},_addReceiptError:function(e,t){this.receiptErrors[e]=t;if(t instanceof this.states.NetworkError){var n=this._checkCache(e,!0);if(n){this.log("Got stale receipt ("+e.substr(0,4)+") status from cache: "+JSON.stringify(n)),this._addReceiptVerification(e,n),this._addReceiptError(e,new this.states.OKStaleCache("Used a stale cache because of network error: "+t));return}}t instanceof this.states.NetworkError?this.state instanceof this.states.VerificationIncomplete&&(this.state=t):t instanceof this.states.OK&&(this.state instanceof this.states.OK||this.state instanceof this.states.VerificationIncomplete)&&(this.state=t)},_addReceiptVerification:function(e,t){this.receiptVerifications[e]=t,this.products.push(this.parseReceipt(e).product)},_checkCache:function(e,t){if(!this._cacheStorage)return null;var n=this._makeKey(e),r=this._cacheStorage.getItem(n);if(!r)return null;try{r=JSON.parse(r)}catch(i){return this._cacheStorage.removeItem(n),null}var s=r.result;if(!t){if(Date.now()-r.created>this.cacheTimeout)return this.log(this.levels.INFO,"Not using cache value because it is expired"),null;if(s.status=="pending")return null;var o=this.parseReceipt(e);return o.iat&&this.refundWindow&&r.created-o.iat<this.refundWindow&&Date.now()-o.iat>this.refundWindow?null:s}return s},_saveResults:function(e,t,n){if(!this._cacheStorage)return;var r=this._makeKey(e),i={created:Date.now(),result:n};this._cacheStorage.setItem(r,JSON.stringify(i))},clearCache:function(){if(!this._cacheStorage)return;var e=[];for(var t=0;t<this._cacheStorage.length;t++){var n=this._cacheStorage.key(t);n.substr(0,16)=="receiptverifier."&&e.push(n)}for(t=0;t<e.length;t++)this._cacheStorage.removeItem(e[t])},_makeKey:function(e){return"receiptverifier."+e},parseReceipt:function(e){if(e.indexOf(".")==-1)throw"Not valid JWT";var t=e.split("~"),n=t[1].split("."),r=n[1];return r=this.base64urldecode(r),r=JSON.parse(r),r},base64urldecode:function(e){e=e.replace(/-/g,"+"),e=e.replace(/_/g,"/");switch(e.length%4){case 0:break;case 1:e+="===";break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}return atob(e)},base64urlencode:function(e){return e=btoa(e),e=e.replace(/\+/g,"-"),e=e.replace(/\//g,"_"),e=e.replace(/[\n=]/g,""),e},levels:{DEBUG:10,INFO:20,NOTIFY:30,WARN:40,ERROR:50},logLevel:2,log:function(e,t){if(!this.onlog||e<this.logLevel)return;this.onlog(e,t)}},n.consoleLogger=function(e,t){if(!console)return;e<=this.levels.DEBUG&&console.debug?console.debug(t):e<=this.levels.INFO&&console.info?console.info(t):e<=this.levels.NOTIFY&&console.log?console.log(t):e<=this.levels.WARN&&console.warn?console.warn(t):console.error?console.error(t):console.log(t)},n.prototype.levels.toString=function(){var e=[];for(var t in this)this.hasOwnProperty(t)&&t!="toString"&&e.push(t);var n=this;return e.sort(function(e,t){return n[e]<n[t]?1:-1}),"{"+e.join(", ")+"}"},n.prototype.states=n.states,n.prototype.errors=n.errors,n.prototype.consoleLogger=n.consoleLogger,n.levels=n.prototype.levels,e.receipts.Verifier=n,e.receipts.verify=function(t,r){var i=new n(r);i.verify(t)};var o=function(e,t,n){function r(n){var r,s,o=Array.prototype.forEach;return r=n.nodeType?[n]:t.querySelectorAll(n),r.each=function(e){return o.call(r,function(t){e.call(t)}),r},r.on=function(e,t){return r.each(function(){i(this,e,t)}),r},r.css=function(t){if(typeof t=="object"){for(s in t)r.each(function(){this.style[s]=t[s]});return r}return e.getComputedStyle(r[0]).getPropertyValue(t)},r.attr=function(e){if(typeof e=="object"){for(s in e)r.each(function(){this.setAttribute(s,e[s])});return r}return r[0].getAttribute(e)},r}var i=r.on=function(e,t,n){e.addEventListener(t,function(e){n.call(e.target,e)},!1)};return r}(typeof window!="undefined"?window:global,typeof document!="undefined"?document:undefined);u.prototype={storeURL:null,allowNoInstall:!1,ignoreInternalError:!1,fatalInternalError:!1,supportHTML:null,templates:{fatalInternalError:"We have encountered a error that keeps us from continuing.  Please contact support: <%= supportHTML %>",internalError:"We have encountered an error.  You may close this dialog to continue, but please also contact support: <%= supportHTML %>",storeInstall:'Please visit the <a href="<%= quote(storeURL) %>">store page</a> to install the application.',refunded:'You purchased this app, but then got a refund.  If you still want to use the application, you must <a href="<%= quote(storeURL) %>">purchase the application again</a>.',invalidReceiptIssuer:'You purchased this application from <%= error.iss %> which is not a store we have a relationship with.  Please either <a href="<%= quote(storeURL) %>">re-purchase the application</a> or contact support: <%= supportHTML %>',invalidFromStore:'The store reports that your purchase receipt is invalid.  Please <a href="<%= quote(storeURL) %>">visit the store to reinstall the application</a>.',receiptFormatError:'Your purchase receipt is malformed.  Please <a href="<%= quote(storeURL) %>">visit the store to reinstall the application</a>.',genericError:'An error has occurred.  <a href="<%= quote(storeURL) %>">Reinstalling the application</a> may fix this problem.  If not please contact support: <%= supportHTML %>',mozAppsNotSupported:"This browser or device does not support the Marketplace Apps system."},respond:function(e){this.verifier=e;if(e.state instanceof e.states.VerificationIncomplete)throw window.console&&console.log&&(console.log("Prompter called with verifier",e,"before verification complete"),console.trace&&console.track()),"Prompter called before verification complete";if(e.state instanceof e.states.OK||e.state instanceof e.states.NetworkError)return;if(e.state instanceof e.states.MozAppsNotSupported){this.handleMozAppsNotSupported(e);return}if(e.state instanceof e.states.InternalError){if(this.ignoreInternalError)return;this.handleInternalError(e);return}if(e.state instanceof e.states.NeedsInstall){this.handleInstall(e);return}if(e.state instanceof e.states.NoValidReceipts){var t=null;e.iterReceiptErrors(function(n,r){t===null?t=r:t instanceof e.states.NetworkError&&(t=r)}),this.handleReceiptError(e,t);return}throw window.console&&console.log&&console.log("Unexpected state: "+e.state),"Unexpected state in verifier: "+e.state},handleMozAppsNotSupported:function(e){var t=!this.allowNoInstall;this.display(this.render(this.templates.mozAppsNotSupported),t)},handleInternalError:function(e){this.fatalInternalError?this.display(this.render(this.templates.fatalInternalError),!0):this.display(this.render(this.templates.internalError),!1)},handleInstall:function(e){var t=!this.allowNoInstall;if(this.allowNoInstall&&e.state instanceof e.states.NoReceipts)return;var n=this.templates.storeInstall,r=this.render(n);this.display(r,t)},handleReceiptError:function(e,t){this.error=t;if(t instanceof e.errors.Refunded)var n=this.templates.refunded;else if(t instanceof e.errors.InvalidReceiptIssuer)var n=this.templates.invalidReceiptIssuer;else if(t instanceof e.errors.InvalidFromStore)var n=this.templates.invalidFromStore;else if(t instanceof e.errors.ReceiptFormatError)var n=this.templates.receiptFormatError;else var n=this.templates.genericError;var r=this.render(n);this.display(r,!this.allowNoInstall)},overlayId:"moz-receiptverifier-overlay",generalStyle:"#OVERLAYID-message,#OVERLAYID-message *,#OVERLAYID-message a:hover,#OVERLAYID-message a:visited,#OVERLAYID-message a:active {\n  bottom:auto;clear:none;cursor:default;font-family:Helvetica,Arial,sans-serif;font-size:medium;font-style:normal;font-weight:normal;  height:auto;left:auto;letter-spacing:normal;line-height:1.4;max-height:none;max-width:none;min-height:0;min-width:0;overflow:visible;  right:auto;text-align:left;text-decoration:none;text-indent:0;text-transform:none;top:auto;visibility:visible;white-space:normal;  width:auto;z-index:auto;\n}\n#OVERLAYID-message a {color: #00f;}\n#OVERLAYID-message a:visited {color:#a0f;}\n#OVERLAYID-message a:hover {text-decoration:underline;}\n#OVERLAYID {\n  position:fixed;top:0;left:0;z-index:9999;background:#000;opacity:0.85;width:100%;height:100%;\n}\n#OVERLAYID-message {\n  z-index:1000;position:fixed;top:100px;left:50%;margin-left:-200px;width:400px;padding:0.75em 1em 0.75em 1em;  border:3px solid #ccc;background:#fff;opacity:1.0;color:#000;border-radius:1em;\n}\n#OVERLAYID-close {\n  display:block;position:fixed;top:91px;left:50%;margin-left:227px;z-index:1001;height:0;width:18px;padding:18px 0 0 0;  overflow:hidden;background:#000 none;border:2px solid #fff;border-radius:18px;  box-shadow:0 0 6px #000,1.6px 1.6px 1.6px rgba(0,0,0,0.3),-1.6px 1.6px 1.6px rgba(0,0,0,0.3),1.6px -1.6px 1.6px rgba(0,0,0,0.3),-1.6px -1.6px 1.6px rgba(0,0,0,0.3);  color:#fff;cursor:pointer;user-select:none;\n}\n#OVERLAYID-close-text {\n  display:block;text-align:center;width:18px;top:0px;left:0px;position:absolute;font-size:18px;line-height:18px;\n}\n",createOverlay:function(e){function r(){n.blocking?n.flash():n.removeOverlay()}this.removeOverlay(),this.addStyle(),this.blocking=e,this.overlay=o(document.createElement("div")),this.overlay.attr({id:this.overlayId}),this.message=o(document.createElement("div")),this.message.attr({id:this.overlayId+"-message"}),this.overlay[0].appendChild(this.message[0]);if(!e){this.close=o(document.createElement("div")),this.close.attr({id:this.overlayId+"-close"});var t=o(document.createElement("div"));t.attr({id:this.overlayId+"-close-text"}),t[0].appendChild(document.createTextNode("Ã—")),this.close[0].appendChild(t[0]),this.overlay[0].appendChild(this.close[0])}o("body").css({"z-index":"-1"})[0].appendChild(this.overlay[0]);var n=this;this.overlay.on("click",function(e){var t=e.target;while(t){if(n.message&&t==n.message[0])return;if(n.overlay&&t==n.overlay[0])break;t=t.parentNode}r()}),this.close&&this.close.on("click",function(){r()}),o(document).on("keypress",function(e){e.keyCode==27&&r()})},flash:function(){if(!this.message)return;this.message.css({border:"3px solid #f00"});var e=this;setTimeout(function(){e.message&&e.message.css({border:"3px solid #ccc"})},2e3)},removeOverlay:function(){var e=o("#"+this.overlayId)[0];e&&e.parentNode.removeChild(e),this.overlay=null,this.message=null,this.close=null},addStyle:function(){var e=this.overlayId+"-style",t=o("#"+e);if(t[0])return;var n=document.createElement("style");n.id=e,n.setAttribute("type","text/css");var r=this.generalStyle;r=r.replace(/OVERLAYID/g,this.overlayId),n.appendChild(document.createTextNode(r)),document.head.appendChild(n)},display:function(e,t){this.message||this.createOverlay(t),this.message[0].innerHTML=e},quote:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&gt;").replace(/"/g,"&quot;")},_templateCache:{},render:function(e,t){t=t||this;if(this._templateCache[e])var n=this._templateCache[e];else{var n=new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");this._templateCache[e]=n}return n(t)}},e.receipts.Prompter=u})(typeof exports=="undefined"?this.mozmarket?this.mozmarket:this.mozmarket={}:exports),define("receiptverifier",function(){}),define("install",["require"],function(e){function t(){var e=t[t.type+"Install"];e?e():t.trigger("error","unsupported install: "+t.type)}function n(e){t.state=e,t.trigger("change",t.state)}t.state="unknown",t.check=function(){var e=navigator.mozApps,r;navigator.mozApps?(t.type="mozilla",r=navigator.mozApps.getSelf(),r.onsuccess=function(){this.result?n("installed"):n("uninstalled")},r.onerror=function(e){t.error=e,n("error")}):typeof chrome!="undefined"&&chrome.webstore&&chrome.app?(t.type="chromeStore",chrome.app.isInstalled?n("installed"):n("uninstalled")):typeof window.navigator.standalone!="undefined"?(t.type="ios",window.navigator.standalone?n("installed"):n("uninstalled")):(t.type="unsupported",n("unsupported"))},t.mozillaInstallUrl=location.href+"manifest.webapp",t.mozillaInstall=function(){var e=navigator.mozApps.install(t.mozillaInstallUrl);e.onsuccess=function(e){n("installed")},e.onerror=function(e){t.error=e,n("error")}},t.chromeInstallUrl=null,t.chromeInstall=function(){chrome.webstore.install(t.chromeInstallUrl,function(){n("installed")},function(e){t.error=e,n("error")})},t.iosInstall=function(){t.trigger("showiOSInstall",navigator.platform.toLowerCase())};var r={};return t.on=function(e,t){r[e]=(r[e]||[]).concat([t])},t.off=function(e,t){if(r[e]){var n=[];for(var i=0,s=r[e].length;i<s;i++){var o=r[e][i];o!=t&&n.push()}r[e]=n}},t.trigger=function(e){var t=Array.prototype.slice.call(arguments,1);if(r[e])for(var n=0,i=r[e].length;n<i;n++)r[e][n].apply(this,t)},t.check(),t}),define("../install-button",["require","install"],function(e){function n(){var e=document.getElementById("install-btn");if(t.state=="uninstalled")e.style.display="block";else if(t.state=="installed"||t.state=="unsupported")e.style.display="none"}function r(){var e=document.getElementById("install-btn");e.addEventListener("click",function(){t()}),t.on("change",n),t.on("error",function(e,t){alert("There was an error during installation.")}),t.on("showiOSInstall",function(){alert('To install, press the forward arrow in Safari and touch "Add to Home Screen"')})}var t=e("install");document.getElementById("install-btn")?r():document.addEventListener("DOMContentLoaded",r)}),function(root){var amdExports;define("zepto",[],function(){return function(){(function(e){String.prototype.trim===e&&(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),Array.prototype.reduce===e&&(Array.prototype.reduce=function(t){if(this===void 0||this===null)throw new TypeError;var n=Object(this),r=n.length>>>0,i=0,s;if(typeof t!="function")throw new TypeError;if(r==0&&arguments.length==1)throw new TypeError;if(arguments.length>=2)s=arguments[1];else do{if(i in n){s=n[i++];break}if(++i>=r)throw new TypeError}while(!0);while(i<r)i in n&&(s=t.call(e,s,n[i],i,n)),i++;return s})})();var Zepto=function(){function C(e){return E.call(e)=="[object Function]"}function k(e){return e instanceof Object}function L(t){var n,r;if(E.call(t)!=="[object Object]")return!1;r=C(t.constructor)&&t.constructor.prototype;if(!r||!hasOwnProperty.call(r,"isPrototypeOf"))return!1;for(n in t);return n===e||hasOwnProperty.call(t,n)}function A(e){return e instanceof Array}function O(e){return typeof e.length=="number"}function M(t){return t.filter(function(t){return t!==e&&t!==null})}function _(e){return e.length>0?[].concat.apply([],e):e}function D(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function P(e){return e in a?a[e]:a[e]=new RegExp("(^|\\s)"+e+"(\\s|$)")}function H(e,t){return typeof t=="number"&&!l[D(e)]?t+"px":t}function B(e){var t,n;return u[e]||(t=o.createElement(e),o.body.appendChild(t),n=f(t,"").getPropertyValue("display"),t.parentNode.removeChild(t),n=="none"&&(n="block"),u[e]=n),u[e]}function j(t,r){return r===e?n(t):n(t).filter(r)}function F(e,t,n,r){return C(t)?t.call(e,n,r):t}function I(e,t,r){var i=e%2?t:t.parentNode;i?i.insertBefore(r,e?e==1?i.firstChild:e==2?t:null:t.nextSibling):n(r).remove()}function q(e,t){t(e);for(var n in e.childNodes)q(e.childNodes[n],t)}var e,t,n,r,i=[],s=i.slice,o=window.document,u={},a={},f=o.defaultView.getComputedStyle,l={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},c=/^\s*<(\w+|!)[^>]*>/,h=[1,3,8,9,11],p=["after","prepend","before","append"],d=o.createElement("table"),v=o.createElement("tr"),m={tr:o.createElement("tbody"),tbody:d,thead:d,tfoot:d,td:v,th:v,"*":o.createElement("div")},g=/complete|loaded|interactive/,y=/^\.([\w-]+)$/,b=/^#([\w-]+)$/,w=/^[\w-]+$/,E={}.toString,S={},x,T,N=o.createElement("div");return S.matches=function(e,t){if(!e||e.nodeType!==1)return!1;var n=e.webkitMatchesSelector||e.mozMatchesSelector||e.oMatchesSelector||e.matchesSelector;if(n)return n.call(e,t);var r,i=e.parentNode,s=!i;return s&&(i=N).appendChild(e),r=~S.qsa(i,t).indexOf(e),s&&N.removeChild(e),r},x=function(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})},T=function(e){return e.filter(function(t,n){return e.indexOf(t)==n})},S.fragment=function(t,r){r===e&&(r=c.test(t)&&RegExp.$1),r in m||(r="*");var i=m[r];return i.innerHTML=""+t,n.each(s.call(i.childNodes),function(){i.removeChild(this)})},S.Z=function(e,t){return e=e||[],e.__proto__=arguments.callee.prototype,e.selector=t||"",e},S.isZ=function(e){return e instanceof S.Z},S.init=function(t,r){if(!t)return S.Z();if(C(t))return n(o).ready(t);if(S.isZ(t))return t;var i;if(A(t))i=M(t);else if(L(t))i=[n.extend({},t)],t=null;else if(h.indexOf(t.nodeType)>=0||t===window)i=[t],t=null;else if(c.test(t))i=S.fragment(t.trim(),RegExp.$1),t=null;else{if(r!==e)return n(r).find(t);i=S.qsa(o,t)}return S.Z(i,t)},n=function(e,t){return S.init(e,t)},n.extend=function(n){return s.call(arguments,1).forEach(function(r){for(t in r)r[t]!==e&&(n[t]=r[t])}),n},S.qsa=function(e,t){var n;return e===o&&b.test(t)?(n=e.getElementById(RegExp.$1))?[n]:i:e.nodeType!==1&&e.nodeType!==9?i:s.call(y.test(t)?e.getElementsByClassName(RegExp.$1):w.test(t)?e.getElementsByTagName(t):e.querySelectorAll(t))},n.isFunction=C,n.isObject=k,n.isArray=A,n.isPlainObject=L,n.inArray=function(e,t,n){return i.indexOf.call(t,e,n)},n.trim=function(e){return e.trim()},n.uuid=0,n.map=function(e,t){var n,r=[],i,s;if(O(e))for(i=0;i<e.length;i++)n=t(e[i],i),n!=null&&r.push(n);else for(s in e)n=t(e[s],s),n!=null&&r.push(n);return _(r)},n.each=function(e,t){var n,r;if(O(e)){for(n=0;n<e.length;n++)if(t.call(e[n],n,e[n])===!1)return e}else for(r in e)if(t.call(e[r],r,e[r])===!1)return e;return e},n.fn={forEach:i.forEach,reduce:i.reduce,push:i.push,indexOf:i.indexOf,concat:i.concat,map:function(e){return n.map(this,function(t,n){return e.call(t,n,t)})},slice:function(){return n(s.apply(this,arguments))},ready:function(e){return g.test(o.readyState)?e(n):o.addEventListener("DOMContentLoaded",function(){e(n)},!1),this},get:function(t){return t===e?s.call(this):this[t]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){this.parentNode!=null&&this.parentNode.removeChild(this)})},each:function(e){return this.forEach(function(t,n){e.call(t,n,t)}),this},filter:function(e){return n([].filter.call(this,function(t){return S.matches(t,e)}))},add:function(e,t){return n(T(this.concat(n(e,t))))},is:function(e){return this.length>0&&S.matches(this[0],e)},not:function(t){var r=[];if(C(t)&&t.call!==e)this.each(function(e){t.call(this,e)||r.push(this)});else{var i=typeof t=="string"?this.filter(t):O(t)&&C(t.item)?s.call(t):n(t);this.forEach(function(e){i.indexOf(e)<0&&r.push(e)})}return n(r)},eq:function(e){return e===-1?this.slice(e):this.slice(e,+e+1)},first:function(){var e=this[0];return e&&!k(e)?e:n(e)},last:function(){var e=this[this.length-1];return e&&!k(e)?e:n(e)},find:function(e){var t;return this.length==1?t=S.qsa(this[0],e):t=this.map(function(){return S.qsa(this,e)}),n(t)},closest:function(e,t){var r=this[0];while(r&&!S.matches(r,e))r=r!==t&&r!==o&&r.parentNode;return n(r)},parents:function(e){var t=[],r=this;while(r.length>0)r=n.map(r,function(e){if((e=e.parentNode)&&e!==o&&t.indexOf(e)<0)return t.push(e),e});return j(t,e)},parent:function(e){return j(T(this.pluck("parentNode")),e)},children:function(e){return j(this.map(function(){return s.call(this.children)}),e)},siblings:function(e){return j(this.map(function(e,t){return s.call(t.parentNode.children).filter(function(e){return e!==t})}),e)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(e){return this.map(function(){return this[e]})},show:function(){return this.each(function(){this.style.display=="none"&&(this.style.display=null),f(this,"").getPropertyValue("display")=="none"&&(this.style.display=B(this.nodeName))})},replaceWith:function(e){return this.before(e).remove()},wrap:function(e){return this.each(function(){n(this).wrapAll(n(e)[0].cloneNode(!1))})},wrapAll:function(e){return this[0]&&(n(this[0]).before(e=n(e)),e.append(this)),this},unwrap:function(){return this.parent().each(function(){n(this).replaceWith(n(this).children())}),this},clone:function(){return n(this.map(function(){return this.cloneNode(!0)}))},hide:function(){return this.css("display","none")},toggle:function(t){return(t===e?this.css("display")=="none":t)?this.show():this.hide()},prev:function(){return n(this.pluck("previousElementSibling"))},next:function(){return n(this.pluck("nextElementSibling"))},html:function(t){return t===e?this.length>0?this[0].innerHTML:null:this.each(function(e){var r=this.innerHTML;n(this).empty().append(F(this,t,e,r))})},text:function(t){return t===e?this.length>0?this[0].textContent:null:this.each(function(){this.textContent=t})},attr:function(n,r){var i;return typeof n=="string"&&r===e?this.length==0||this[0].nodeType!==1?e:n=="value"&&this[0].nodeName=="INPUT"?this.val():!(i=this[0].getAttribute(n))&&n in this[0]?this[0][n]:i:this.each(function(e){if(this.nodeType!==1)return;if(k(n))for(t in n)this.setAttribute(t,n[t]);else this.setAttribute(n,F(this,r,e,this.getAttribute(n)))})},removeAttr:function(e){return this.each(function(){this.nodeType===1&&this.removeAttribute(e)})},prop:function(t,n){return n===e?this[0]?this[0][t]:e:this.each(function(e){this[t]=F(this,n,e,this[t])})},data:function(t,n){var r=this.attr("data-"+D(t),n);return r!==null?r:e},val:function(t){return t===e?this.length>0?this[0].value:e:this.each(function(e){this.value=F(this,t,e,this.value)})},offset:function(){if(this.length==0)return null;var e=this[0].getBoundingClientRect();return{left:e.left+window.pageXOffset,top:e.top+window.pageYOffset,width:e.width,height:e.height}},css:function(n,r){if(r===e&&typeof n=="string")return this.length==0?e:this[0].style[x(n)]||f(this[0],"").getPropertyValue(n);var i="";for(t in n)typeof n[t]=="string"&&n[t]==""?this.each(function(){this.style.removeProperty(D(t))}):i+=D(t)+":"+H(t,n[t])+";";return typeof n=="string"&&(r==""?this.each(function(){this.style.removeProperty(D(n))}):i=D(n)+":"+H(n,r)),this.each(function(){this.style.cssText+=";"+i})},index:function(e){return e?this.indexOf(n(e)[0]):this.parent().children().indexOf(this[0])},hasClass:function(e){return this.length<1?!1:P(e).test(this[0].className)},addClass:function(e){return this.each(function(t){r=[];var i=this.className,s=F(this,e,t,i);s.split(/\s+/g).forEach(function(e){n(this).hasClass(e)||r.push(e)},this),r.length&&(this.className+=(i?" ":"")+r.join(" "))})},removeClass:function(t){return this.each(function(n){if(t===e)return this.className="";r=this.className,F(this,t,n,r).split(/\s+/g).forEach(function(e){r=r.replace(P(e)," ")}),this.className=r.trim()})},toggleClass:function(t,r){return this.each(function(i){var s=F(this,t,i,this.className);(r===e?!n(this).hasClass(s):r)?n(this).addClass(s):n(this).removeClass(s)})}},["width","height"].forEach(function(t){n.fn[t]=function(r){var i,s=t.replace(/./,function(e){return e[0].toUpperCase()});return r===e?this[0]==window?window["inner"+s]:this[0]==o?o.documentElement["offset"+s]:(i=this.offset())&&i[t]:this.each(function(e){var i=n(this);i.css(t,F(this,r,e,i[t]()))})}}),p.forEach(function(e,t){n.fn[e]=function(){var e=n.map(arguments,function(e){return k(e)?e:S.fragment(e)});if(e.length<1)return this;var r=this.length,i=r>1,s=t<2;return this.each(function(n,o){for(var u=0;u<e.length;u++){var a=e[s?e.length-u-1:u];q(a,function(e){e.nodeName!=null&&e.nodeName.toUpperCase()==="SCRIPT"&&(!e.type||e.type==="text/javascript")&&window.eval.call(window,e.innerHTML)}),i&&n<r-1&&(a=a.cloneNode(!0)),I(t,o,a)}})},n.fn[t%2?e+"To":"insert"+(t?"Before":"After")]=function(t){return n(t)[e](this),this}}),S.Z.prototype=n.fn,S.camelize=x,S.uniq=T,n.zepto=S,n}();window.Zepto=Zepto,"$"in window||(window.$=Zepto),function(e){function s(e){return e._zid||(e._zid=r++)}function o(e,t,r,i){t=u(t);if(t.ns)var o=a(t.ns);return(n[s(e)]||[]).filter(function(e){return e&&(!t.e||e.e==t.e)&&(!t.ns||o.test(e.ns))&&(!r||s(e.fn)===s(r))&&(!i||e.sel==i)})}function u(e){var t=(""+e).split(".");return{e:t[0],ns:t.slice(1).sort().join(" ")}}function a(e){return new RegExp("(?:^| )"+e.replace(" "," .* ?")+"(?: |$)")}function f(t,n,r){e.isObject(t)?e.each(t,r):t.split(/\s/).forEach(function(e){r(e,n)})}function l(t,r,i,o,a,l){l=!!l;var c=s(t),h=n[c]||(n[c]=[]);f(r,i,function(n,r){var i=a&&a(r,n),s=i||r,f=function(e){var n=s.apply(t,[e].concat(e.data));return n===!1&&e.preventDefault(),n},c=e.extend(u(n),{fn:r,proxy:f,sel:o,del:i,i:h.length});h.push(c),t.addEventListener(c.e,f,l)})}function c(e,t,r,i){var u=s(e);f(t||"",r,function(t,r){o(e,t,r,i).forEach(function(t){delete n[u][t.i],e.removeEventListener(t.e,t.proxy,!1)})})}function v(t){var n=e.extend({originalEvent:t},t);return e.each(d,function(e,r){n[e]=function(){return this[r]=h,t[e].apply(t,arguments)},n[r]=p}),n}function m(e){if(!("defaultPrevented"in e)){e.defaultPrevented=!1;var t=e.preventDefault;e.preventDefault=function(){this.defaultPrevented=!0,t.call(this)}}}var t=e.zepto.qsa,n={},r=1,i={};i.click=i.mousedown=i.mouseup=i.mousemove="MouseEvents",e.event={add:l,remove:c},e.proxy=function(t,n){if(e.isFunction(t)){var r=function(){return t.apply(n,arguments)};return r._zid=s(t),r}if(typeof n=="string")return e.proxy(t[n],t);throw new TypeError("expected function")},e.fn.bind=function(e,t){return this.each(function(){l(this,e,t)})},e.fn.unbind=function(e,t){return this.each(function(){c(this,e,t)})},e.fn.one=function(e,t){return this.each(function(n,r){l(this,e,t,null,function(e,t){return function(){var n=e.apply(r,arguments);return c(r,t,e),n}})})};var h=function(){return!0},p=function(){return!1},d={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};e.fn.delegate=function(t,n,r){var i=!1;if(n=="blur"||n=="focus")e.iswebkit?n=n=="blur"?"focusout":n=="focus"?"focusin":n:i=!0;return this.each(function(s,o){l(o,n,r,t,function(n){return function(r){var i,s=e(r.target).closest(t,o).get(0);if(s)return i=e.extend(v(r),{currentTarget:s,liveFired:o}),n.apply(s,[i].concat([].slice.call(arguments,1)))}},i)})},e.fn.undelegate=function(e,t,n){return this.each(function(){c(this,t,n,e)})},e.fn.live=function(t,n){return e(document.body).delegate(this.selector,t,n),this},e.fn.die=function(t,n){return e(document.body).undelegate(this.selector,t,n),this},e.fn.on=function(t,n,r){return n==undefined||e.isFunction(n)?this.bind(t,n):this.delegate(n,t,r)},e.fn.off=function(t,n,r){return n==undefined||e.isFunction(n)?this.unbind(t,n):this.undelegate(n,t,r)},e.fn.trigger=function(t,n){return typeof t=="string"&&(t=e.Event(t)),m(t),t.data=n,this.each(function(){"dispatchEvent"in this&&this.dispatchEvent(t)})},e.fn.triggerHandler=function(t,n){var r,i;return this.each(function(s,u){r=v(typeof t=="string"?e.Event(t):t),r.data=n,r.target=u,e.each(o(u,t.type||t),function(e,t){i=t.proxy(r);if(r.isImmediatePropagationStopped())return!1})}),i},"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout change select keydown keypress keyup error".split(" ").forEach(function(t){e.fn[t]=function(e){return this.bind(t,e)}}),["focus","blur"].forEach(function(t){e.fn[t]=function(e){if(e)this.bind(t,e);else if(this.length)try{this.get(0)[t]()}catch(n){}return this}}),e.Event=function(e,t){var n=document.createEvent(i[e]||"Events"),r=!0;if(t)for(var s in t)s=="bubbles"?r=!!t[s]:n[s]=t[s];return n.initEvent(e,r,!0,null,null,null,null,null,null,null,null,null,null,null,null),n}}(Zepto),function(e){function t(e){var t=this.os={},n=this.browser={},r=e.match(/WebKit\/([\d.]+)/),i=e.match(/(Android)\s+([\d.]+)/),s=e.match(/(iPad).*OS\s([\d_]+)/),o=!s&&e.match(/(iPhone\sOS)\s([\d_]+)/),u=e.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),a=u&&e.match(/TouchPad/),f=e.match(/Kindle\/([\d.]+)/),l=e.match(/Silk\/([\d._]+)/),c=e.match(/(BlackBerry).*Version\/([\d.]+)/);if(n.webkit=!!r)n.version=r[1];i&&(t.android=!0,t.version=i[2]),o&&(t.ios=t.iphone=!0,t.version=o[2].replace(/_/g,".")),s&&(t.ios=t.ipad=!0,t.version=s[2].replace(/_/g,".")),u&&(t.webos=!0,t.version=u[2]),a&&(t.touchpad=!0),c&&(t.blackberry=!0,t.version=c[2]),f&&(t.kindle=!0,t.version=f[1]),l&&(n.silk=!0,n.version=l[1]),!l&&t.android&&e.match(/Kindle Fire/)&&(n.silk=!0)}t.call(e,navigator.userAgent),e.__detect=t}(Zepto),function(e,t){function c(e){return e.toLowerCase()}function h(e){return r?r+e:c(e)}var n="",r,i,s,o={Webkit:"webkit",Moz:"",O:"o",ms:"MS"},u=window.document,a=u.createElement("div"),f=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i,l={};e.each(o,function(e,i){if(a.style[e+"TransitionProperty"]!==t)return n="-"+c(e)+"-",r=i,!1}),l[n+"transition-property"]=l[n+"transition-duration"]=l[n+"transition-timing-function"]=l[n+"animation-name"]=l[n+"animation-duration"]="",e.fx={off:r===t&&a.style.transitionProperty===t,cssPrefix:n,transitionEnd:h("TransitionEnd"),animationEnd:h("AnimationEnd")},e.fn.animate=function(t,n,r,i){return e.isObject(n)&&(r=n.easing,i=n.complete,n=n.duration),n&&(n/=1e3),this.anim(t,n,r,i)},e.fn.anim=function(r,i,s,o){var u,a={},c,h=this,p,d=e.fx.transitionEnd;i===t&&(i=.4),e.fx.off&&(i=0);if(typeof r=="string")a[n+"animation-name"]=r,a[n+"animation-duration"]=i+"s",d=e.fx.animationEnd;else{for(c in r)f.test(c)?(u||(u=[]),u.push(c+"("+r[c]+")")):a[c]=r[c];u&&(a[n+"transform"]=u.join(" ")),!e.fx.off&&typeof r=="object"&&(a[n+"transition-property"]=Object.keys(r).join(", "),a[n+"transition-duration"]=i+"s",a[n+"transition-timing-function"]=s||"linear")}return p=function(t){if(typeof t!="undefined"){if(t.target!==t.currentTarget)return;e(t.target).unbind(d,arguments.callee)}e(this).css(l),o&&o.call(this)},i>0&&this.bind(d,p),setTimeout(function(){h.css(a),i<=0&&setTimeout(function(){h.each(function(){p.call(this)})},0)},0),this},a=null}(Zepto),function($){function triggerAndReturn(e,t,n){var r=$.Event(t);return $(e).trigger(r,n),!r.defaultPrevented}function triggerGlobal(e,t,n,r){if(e.global)return triggerAndReturn(t||document,n,r)}function ajaxStart(e){e.global&&$.active++===0&&triggerGlobal(e,null,"ajaxStart")}function ajaxStop(e){e.global&&!--$.active&&triggerGlobal(e,null,"ajaxStop")}function ajaxBeforeSend(e,t){var n=t.context;if(t.beforeSend.call(n,e,t)===!1||triggerGlobal(t,n,"ajaxBeforeSend",[e,t])===!1)return!1;triggerGlobal(t,n,"ajaxSend",[e,t])}function ajaxSuccess(e,t,n){var r=n.context,i="success";n.success.call(r,e,i,t),triggerGlobal(n,r,"ajaxSuccess",[t,n,e]),ajaxComplete(i,t,n)}function ajaxError(e,t,n,r){var i=r.context;r.error.call(i,n,t,e),triggerGlobal(r,i,"ajaxError",[n,r,e]),ajaxComplete(t,n,r)}function ajaxComplete(e,t,n){var r=n.context;n.complete.call(r,t,e),triggerGlobal(n,r,"ajaxComplete",[t,n]),ajaxStop(n)}function empty(){}function mimeToDataType(e){return e&&(e==htmlType?"html":e==jsonType?"json":scriptTypeRE.test(e)?"script":xmlTypeRE.test(e)&&"xml")||"text"}function appendQuery(e,t){return(e+"&"+t).replace(/[&?]{1,2}/,"?")}function serializeData(e){isObject(e.data)&&(e.data=$.param(e.data)),e.data&&(!e.type||e.type.toUpperCase()=="GET")&&(e.url=appendQuery(e.url,e.data))}function serialize(e,t,n,r){var i=$.isArray(t);$.each(t,function(t,s){r&&(t=n?r:r+"["+(i?"":t)+"]"),!r&&i?e.add(s.name,s.value):(n?$.isArray(s):isObject(s))?serialize(e,s,n,t):e.add(t,s)})}var jsonpID=0,isObject=$.isObject,document=window.document,key,name,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,scriptTypeRE=/^(?:text|application)\/javascript/i,xmlTypeRE=/^(?:text|application)\/xml/i,jsonType="application/json",htmlType="text/html",blankRE=/^\s*$/;$.active=0,$.ajaxJSONP=function(e){var t="jsonp"+ ++jsonpID,n=document.createElement("script"),r=function(){$(n).remove(),t in window&&(window[t]=empty),ajaxComplete("abort",i,e)},i={abort:r},s;return e.error&&(n.onerror=function(){i.abort(),e.error()}),window[t]=function(r){clearTimeout(s),$(n).remove(),delete window[t],ajaxSuccess(r,i,e)},serializeData(e),n.src=e.url.replace(/=\?/,"="+t),$("head").append(n),e.timeout>0&&(s=setTimeout(function(){i.abort(),ajaxComplete("timeout",i,e)},e.timeout)),i},$.ajaxSettings={type:"GET",beforeSend:empty,success:empty,error:empty,complete:empty,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript",json:jsonType,xml:"application/xml, text/xml",html:htmlType,text:"text/plain"},crossDomain:!1,timeout:0},$.ajax=function(options){var settings=$.extend({},options||{});for(key in $.ajaxSettings)settings[key]===undefined&&(settings[key]=$.ajaxSettings[key]);ajaxStart(settings),settings.crossDomain||(settings.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(settings.url)&&RegExp.$2!=window.location.host);var dataType=settings.dataType,hasPlaceholder=/=\?/.test(settings.url);if(dataType=="jsonp"||hasPlaceholder)return hasPlaceholder||(settings.url=appendQuery(settings.url,"callback=?")),$.ajaxJSONP(settings);settings.url||(settings.url=window.location.toString()),serializeData(settings);var mime=settings.accepts[dataType],baseHeaders={},protocol=/^([\w-]+:)\/\//.test(settings.url)?RegExp.$1:window.location.protocol,xhr=$.ajaxSettings.xhr(),abortTimeout;settings.crossDomain||(baseHeaders["X-Requested-With"]="XMLHttpRequest"),mime&&(baseHeaders.Accept=mime,mime.indexOf(",")>-1&&(mime=mime.split(",",2)[0]),xhr.overrideMimeType&&xhr.overrideMimeType(mime));if(settings.contentType||settings.data&&settings.type.toUpperCase()!="GET")baseHeaders["Content-Type"]=settings.contentType||"application/x-www-form-urlencoded";settings.headers=$.extend(baseHeaders,settings.headers||{}),xhr.onreadystatechange=function(){if(xhr.readyState==4){clearTimeout(abortTimeout);var result,error=!1;if(xhr.status>=200&&xhr.status<300||xhr.status==304||xhr.status==0&&protocol=="file:"){dataType=dataType||mimeToDataType(xhr.getResponseHeader("content-type")),result=xhr.responseText;try{dataType=="script"?(1,eval)(result):dataType=="xml"?result=xhr.responseXML:dataType=="json"&&(result=blankRE.test(result)?null:JSON.parse(result))}catch(e){error=e}error?ajaxError(error,"parsererror",xhr,settings):ajaxSuccess(result,xhr,settings)}else ajaxError(null,"error",xhr,settings)}};var async="async"in settings?settings.async:!0;xhr.open(settings.type,settings.url,async);for(name in settings.headers)xhr.setRequestHeader(name,settings.headers[name]);return ajaxBeforeSend(xhr,settings)===!1?(xhr.abort(),!1):(settings.timeout>0&&(abortTimeout=setTimeout(function(){xhr.onreadystatechange=empty,xhr.abort(),ajaxError(null,"timeout",xhr,settings)},settings.timeout)),xhr.send(settings.data?settings.data:null),xhr)},$.get=function(e,t){return $.ajax({url:e,success:t})},$.post=function(e,t,n,r){return $.isFunction(t)&&(r=r||n,n=t,t=null),$.ajax({type:"POST",url:e,data:t,success:n,dataType:r})},$.getJSON=function(e,t){return $.ajax({url:e,success:t,dataType:"json"})},$.fn.load=function(e,t){if(!this.length)return this;var n=this,r=e.split(/\s/),i;return r.length>1&&(e=r[0],i=r[1]),$.get(e,function(e){n.html(i?$(document.createElement("div")).html(e.replace(rscript,"")).find(i).html():e),t&&t.call(n)}),this};var escape=encodeURIComponent;$.param=function(e,t){var n=[];return n.add=function(e,t){this.push(escape(e)+"="+escape(t))},serialize(n,e,t),n.join("&").replace("%20","+")}}(Zepto),function(e){e.fn.serializeArray=function(){var t=[],n;return e(Array.prototype.slice.call(this.get(0).elements)).each(function(){n=e(this);var r=n.attr("type");this.nodeName.toLowerCase()!="fieldset"&&!this.disabled&&r!="submit"&&r!="reset"&&r!="button"&&(r!="radio"&&r!="checkbox"||this.checked)&&t.push({name:n.attr("name"),value:n.val()})}),t},e.fn.serialize=function(){var e=[];return this.serializeArray().forEach(function(t){e.push(encodeURIComponent(t.name)+"="+encodeURIComponent(t.value))}),e.join("&")},e.fn.submit=function(t){if(t)this.bind("submit",t);else if(this.length){var n=e.Event("submit");this.eq(0).trigger(n),n.defaultPrevented||this.get(0).submit()}return this}}(Zepto),function(e){function r(e){return"tagName"in e?e:e.parentNode}function i(e,t,n,r){var i=Math.abs(e-t),s=Math.abs(n-r);return i>=s?e-t>0?"Left":"Right":n-r>0?"Up":"Down"}function u(){o=null,t.last&&(t.el.trigger("longTap"),t={})}function a(){o&&clearTimeout(o),o=null}var t={},n,s=750,o;e(document).ready(function(){var f,l;e(document.body).bind("touchstart",function(i){f=Date.now(),l=f-(t.last||f),t.el=e(r(i.touches[0].target)),n&&clearTimeout(n),t.x1=i.touches[0].pageX,t.y1=i.touches[0].pageY,l>0&&l<=250&&(t.isDoubleTap=!0),t.last=f,o=setTimeout(u,s)}).bind("touchmove",function(e){a(),t.x2=e.touches[0].pageX,t.y2=e.touches[0].pageY}).bind("touchend",function(e){a(),t.isDoubleTap?(t.el.trigger("doubleTap"),t={}):t.x2&&Math.abs(t.x1-t.x2)>30||t.y2&&Math.abs(t.y1-t.y2)>30?(t.el.trigger("swipe")&&t.el.trigger("swipe"+i(t.x1,t.x2,t.y1,t.y2)),t={}):"last"in t&&(t.el.trigger("tap"),n=setTimeout(function(){n=null,t.el.trigger("singleTap"),t={}},250))}).bind("touchcancel",function(){n&&clearTimeout(n),o&&clearTimeout(o),o=n=null,t={}})}),["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","doubleTap","tap","singleTap","longTap"].forEach(function(t){e.fn[t]=function(e){return this.bind(t,e)}})}(Zepto),amdExports=Zepto}.call(root),amdExports})}(this),function(){function r(t,n){n&&f.tagList.length&&t.childNodes.length&&f.query(t,f.tagList).forEach(function(e){r(e)}),f.tagCheck(t)&&(f.extendElement(t),e.documentElement.contains(t)&&f.getOptions(t).onInsert.call(t))}function o(e,t,n){switch(f.typeOf(n)){case"object":f.typeOf(e[t])=="object"?f.merge(e[t],n):e[t]=f.clone(n);break;case"array":e[t]=f.toArray(n);break;default:e[t]=n}return e}function h(){f.observe(e.documentElement,r),f.tagList.length&&f.query(e,f.tagList).forEach(function(e){r(e)}),f.domready=!0,f.fireEvent(e,"DOMComponentsLoaded"),f.fireEvent(e,"__DOMComponentsLoaded__")}var e=document,t=window,n=e.getElementsByTagName("head")[0],s=function(){var n=t.getComputedStyle(e.documentElement,""),r=(Array.prototype.slice.call(n).join("").match(/moz|webkit|ms/)||n.OLink===""&&["o"])[0],i="WebKit|Moz|MS|O".match(new RegExp("("+r+")","i"))[1];return{dom:i,lowercase:r,css:"-"+r+"-",js:r[0].toUpperCase()+r.substr(1)}}(),u={listener:function(e,t,n){!!~e.value.match(/(\d+)/g).indexOf(String(n[0].keyCode))==(e.name=="keypass")&&(n.splice(n.length,0,this),t.apply(this,n))}},a={mouseenter:"touchenter",mouseleave:"touchleave",mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend",click:"touchend"},f={tags:{},tagList:[],callbacks:{},prefix:s,anchor:e.createElement("a"),mutation:t.MutationObserver||t.WebKitMutationObserver||t.MozMutationObserver,_matchSelector:document.documentElement.matchesSelector||document.documentElement.mozMatchesSelector||document.documentElement.webkitMatchesSelector,tagOptions:{content:"",mixins:[],events:{},methods:{},getters:{},setters:{},onCreate:function(){},onInsert:function(){}},eventMap:{animationstart:["animationstart","oAnimationStart","MSAnimationStart","webkitAnimationStart"],transitionend:["transitionend","oTransitionEnd","MSTransitionEnd","webkitTransitionEnd"],tap:["ontouchend"in e?"touchend":"mouseup"]},pseudos:{delegate:{listener:function(e,t,n){var r=f.query(this,e.value).filter(function(e){return e==n[0].target||e.contains?e.contains(n[0].target):!1})[0];return r?t.apply(r,n):!1}},preventable:{listener:function(e,t,n){n[0].defaultPrevented||t.apply(this,n)}},attribute:{onAdd:function(e){this.xtag.attributeSetters=this.xtag.attributeSetters||{},this.xtag.attributeSetters[e.value]=e.key.split(":")[0]},listener:function(e,t,n){t.call(this,n[0]),this.setAttribute(e.value,n[0],!0)}},touch:{onAdd:function(e,t){this.addEventListener(a[e.key.split(":")[0]],t,!1)},listener:function(e,t,n){t.touched&&n[0].type.match("mouse")?t.touched=!1:(n[0].type.match("touch")&&(t.touched=!0),n.splice(n.length,0,this),t.apply(this,n))},onRemove:function(e,t){this.removeEventListener(a[e.key.split(":")[0]],t)}},keystop:u,keypass:u},mixins:{request:{onInsert:function(){this.src=this.getAttribute("src")},getters:{dataready:function(){return this.xtag.dataready}},setters:{src:function(e){e&&(this.setAttribute("src",e),f.request(this,{url:e,method:"GET"}))},dataready:function(e){this.xtag.dataready=e,this.xtag.request&&this.xtag.request.readyState==4&&e.call(this,this.xtag.request)}}}},typeOf:function(e){return{}.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},toArray:function(e){var t=Array.prototype.slice.call(e,0);return t.hasOwnProperty?t:[e]},hasClass:function(e,t){return!!~e.className.split(" ").indexOf(t)},addClass:function(e,t){if(!f.hasClass(e,t)){var n=e.className.split(" ").filter(function(e){return e!=""});n.push(t),e.className=n.join(" ")}return e},removeClass:function(e,t){var n=e.className.split(" ").filter(function(e){return e!=""}),r=n.indexOf(t);return r>=0&&n.splice(r,1),e.className=n.join(" "),e},toggleClass:function(e,t){return f.hasClass(e,t)?f.removeClass(e,t):f.addClass(e,t)},matchSelector:function(e,t){return f._matchSelector.call(e,t)},query:function(e,t){return f.toArray(e.querySelectorAll(t))},queryChildren:function(e,t){var n=null,r="x-"+(new Date).getTime(),i='[xtag-temp-id="'+r+'"] > ',t=i+(t+"").replace(",",","+i,"g");return e.setAttribute("xtag-temp-id",r),n=e.parentNode.querySelectorAll(t),e.removeAttribute("xtag-temp-id"),f.toArray(n)},defineProperty:function(t,n,r,i){return e.documentElement.__defineGetter__?function(e,t,n,r){e["__define"+n[0].toUpperCase()+"etter__"](t,r)}:function(e,t,n,r){var i={configurable:!0};i[n]=r,Object.defineProperty(e,t,i)}}(),clone:function(e){var t=function(){};return t.prototype=e,new t},merge:function(e,t,n){if(f.typeOf(t)=="string")return o(e,t,n);for(var r=1,i=arguments.length;r<i;r++){var s=arguments[r];for(var u in s)o(e,u,s[u])}return e},wrap:function(e,t){return function(){var n=f.toArray(arguments);e.apply(this,n),t.apply(this,n)}},skipTransition:function(e,t,n){var r=s.js+"TransitionDuration";e.style[r]="0.001s",t.call(n),f.addEvent(e,"transitionend",function(){e.style[r]=""})},tagCheck:function(e){return e.nodeName?f.tags[e.nodeName.toLowerCase()]:!1},getOptions:function(e){return f.tagCheck(e)||f.tagOptions},register:function(t,n){f.tagList.push(t),f.tags[t]=f.merge({tagName:t},f.tagOptions,f.applyMixins(n||{})),f.domready&&f.query(e,t).forEach(function(e){r(e)})},extendElement:function(e){if(!e.xtag&&f.tagCheck(e)){e.xtag={};var t=f.getOptions(e);for(var n in t.methods)f.bindMethod(e,n,t.methods[n]);for(var n in t.setters)f.applyAccessor(e,n,"set",t.setters[n]);for(var n in t.getters)f.applyAccessor(e,n,"get",t.getters[n]);f.addEvents(e,t.events),t.content&&(e.innerHTML=t.content),t.onCreate.call(e)}},innerHTML:function(e,t){e.innerHTML=t,f.observer?f.parseMutations(f.observer.takeRecords(),r):r(e)},bindMethod:function(e,t,n){e[t]=function(){return n.apply(e,f.toArray(arguments))}},applyMixins:function(e){return e.mixins&&e.mixins.forEach(function(t){var n=f.mixins[t];for(var r in n)switch(f.typeOf(n[r])){case"function":e[r]=e[r]?f.wrap(e[r],n[r]):n[r];break;case"object":e[r]=f.merge({},n[r],e[r]);break;default:e[r]=n[r]}}),e},applyAccessor:function(e,t,n,r){f.defineProperty(e,t.split(":")[0],n,f.applyPseudos(e,t,r))},applyPseudos:function(e,t,n){var r=n,i={};if(t.match(":")){var s=t.match(/(\w+(?:\([^\)]+\))?)/g);for(var o=s.length-1;o>0;o--)s[o].replace(/(\w*)(?:\(([^\)]*)\))?/,function(n,s,o){var u=r,a=f.pseudos[s],l={key:t,name:s,value:o};a.onAdd&&(i[s]=l),r=function(t){t&&(t.customElement=e);var n=f.toArray(arguments);return n[1]=e,a.listener.apply(this,[l,u,n])}});for(var u in i)f.pseudos[u].onAdd.call(e,i[u],r)}return r},removePseudos:function(e,t,n){t.match(":")&&t.replace(/:(\w*)(?:\(([^\)]*)\))?/g,function(n,r,i){var s=action,o=f.pseudos[r],u={key:t,name:r,value:i};o.onRemove&&o.onRemove.call(e,u,s)})},request:function(r,i){f.clearRequest(r);var s=r.xtag.request||{};r.xtag.request=i;var o=r.xtag.request,u=r.getAttribute("data-callback-key")||"callback=xtag.callbacks.";if(f.fireEvent(r,"beforerequest")===!1)return!1;if(s.url&&!i.update&&s.url.replace(new RegExp("&?("+u+"x[0-9]+)"),"")==r.xtag.request.url)return r.xtag.request=s,!1;r.setAttribute("src",r.xtag.request.url),f.anchor.href=i.url;if(f.anchor.hostname==t.location.hostname)o=f.merge(new XMLHttpRequest,o),o.onreadystatechange=function(){r.setAttribute("data-readystate",o.readyState),o.readyState==4&&o.status<400&&f.requestCallback(r,o)},["error","abort","load"].forEach(function(e){o["on"+e]=function(t){t.request=o,f.fireEvent(r,e,t)}}),o.open(o.method,o.url,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send();else{var a=o.callbackID="x"+(new Date).getTime();r.setAttribute("data-readystate",o.readyState=0),f.callbacks[a]=function(e){o.status=200,o.readyState=4,o.responseText=e,f.requestCallback(r,o),delete f.callbacks[a],f.clearRequest(r)},o.script=e.createElement("script"),o.script.type="text/javascript",o.script.src=i.url=i.url+(~i.url.indexOf("?")?"&":"?")+u+a,o.script.onerror=function(e){r.setAttribute("data-readystate",o.readyState=4),r.setAttribute("data-requeststatus",o.status=400),f.fireEvent(r,"error",e)},n.appendChild(o.script)}r.xtag.request=o},requestCallback:function(e,t){if(t!=e.xtag.request)return f;e.setAttribute("data-readystate",t.readyState),e.setAttribute("data-requeststatus",t.status),f.fireEvent(e,"dataready",{request:t}),e.dataready&&e.dataready.call(e,t)},clearRequest:function(e){var t=e.xtag.request;if(!t)return f;t.script&&~f.toArray(n.children).indexOf(t.script)?n.removeChild(t.script):t.abort&&t.abort()},addEvent:function(e,t,n){var r=t.split(":")[0],i=f.eventMap[r]||[r],s=f.applyPseudos(e,t,n);return i.forEach(function(t){e.addEventListener(t,s,!!~["focus","blur"].indexOf(t))}),s},addEvents:function(e,t){for(var n in t)f.addEvent(e,n,t[n])},removeEvent:function(e,t,n){var r=t.split(":")[0],i=f.eventMap[r]||[r];i.forEach(function(t){e.removeEventListener(t,n)})},fireEvent:function(t,n,r,i){var i=i||{},s=e.createEvent("Event");s.initEvent(n,"bubbles"in i?i.bubbles:!0,"cancelable"in i?i.cancelable:!0),t.dispatchEvent(f.merge(s,r))},parseMutations:function(e,t){var n=[];e.forEach(function(e){var r=e.addedNodes,s=r.length;for(i=0;i<s&&n.indexOf(r[i])==-1;i++)n.push(r[i]),t(r[i],!0)})},observe:function(e,t){if(f.mutation){var n=new f.mutation(function(e){f.parseMutations(e,t)});n.observe(e,{subtree:!0,childList:!0,attributes:!1,characterData:!1}),f.observer=n}else e.addEventListener("DOMNodeInserted",function(e){t(e.target,!0)},!1)}},l=HTMLElement.prototype.setAttribute;(t.HTMLUnknownElement||HTMLElement).prototype.setAttribute=function(e,t,n){!n&&this.xtag&&this.xtag.attributeSetters&&(this[this.xtag.attributeSetters[e]]=t),l.call(this,e,t)};var c=e.createElement;e.createElement=function(e){var t=c.call(this,e);return f.extendElement(t),t},e.readyState=="complete"?h():e.readyState=="interactive"?e.addEventListener("readystatechange",function(e){h()}):e.addEventListener("DOMContentLoaded",function(e){h()},!1),typeof define=="function"&&define.amd?define("x-tag",[],f):t.xtag=f}(),function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=r.unshift,l=i.toString,c=i.hasOwnProperty,h=r.forEach,p=r.map,d=r.reduce,v=r.reduceRight,m=r.filter,g=r.every,y=r.some,b=r.indexOf,w=r.lastIndexOf,E=Array.isArray,S=Object.keys,x=s.bind,T=function(e){if(e instanceof T)return e;if(!(this instanceof T))return new T(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=T),exports._=T):e._=T,T.VERSION="1.4.1";var N=T.each=T.forEach=function(e,t,r){if(h&&e.forEach===h)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(T.has(e,o)&&t.call(r,e[o],o,e)===n)return};T.map=T.collect=function(e,t,n){var r=[];return p&&e.map===p?e.map(t,n):(N(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)},T.reduce=T.foldl=T.inject=function(e,t,n,r){var i=arguments.length>2;if(d&&e.reduce===d)return r&&(t=T.bind(t,r)),i?e.reduce(t,n):e.reduce(t);N(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},T.reduceRight=T.foldr=function(e,t,n,r){var i=arguments.length>2;if(v&&e.reduceRight===v)return r&&(t=T.bind(t,r)),arguments.length>2?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=T.keys(e);s=o.length}N(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},T.find=T.detect=function(e,t,n){var r;return C(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},T.filter=T.select=function(e,t,n){var r=[];return m&&e.filter===m?e.filter(t,n):(N(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},T.reject=function(e,t,n){var r=[];return N(e,function(e,i,s){t.call(n,e,i,s)||(r[r.length]=e)}),r},T.every=T.all=function(e,t,r){t||(t=T.identity);var i=!0;return g&&e.every===g?e.every(t,r):(N(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var C=T.some=T.any=function(e,t,r){t||(t=T.identity);var i=!1;return y&&e.some===y?e.some(t,r):(N(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};T.contains=T.include=function(e,t){var n=!1;return b&&e.indexOf===b?e.indexOf(t)!=-1:(n=C(e,function(e){return e===t}),n)},T.invoke=function(e,t){var n=u.call(arguments,2);return T.map(e,function(e){return(T.isFunction(t)?t:e[t]).apply(e,n)})},T.pluck=function(e,t){return T.map(e,function(e){return e[t]})},T.where=function(e,t){return T.isEmpty(t)?[]:T.filter(e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},T.max=function(e,t,n){if(!t&&T.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&T.isEmpty(e))return-Infinity;var r={computed:-Infinity};return N(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},T.min=function(e,t,n){if(!t&&T.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&T.isEmpty(e))return Infinity;var r={computed:Infinity};return N(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},T.shuffle=function(e){var t,n=0,r=[];return N(e,function(e){t=T.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return T.isFunction(e)?e:function(t){return t[e]}};T.sortBy=function(e,t,n){var r=k(t);return T.pluck(T.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t);return N(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};T.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(T.has(e,t)?e[t]:e[t]=[]).push(n)})},T.countBy=function(e,t,n){return L(e,t,n,function(e,t,n){T.has(e,t)||(e[t]=0),e[t]++})},T.sortedIndex=function(e,t,n,r){n=n==null?T.identity:k(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},T.toArray=function(e){return e?e.length===+e.length?u.call(e):T.values(e):[]},T.size=function(e){return e.length===+e.length?e.length:T.keys(e).length},T.first=T.head=T.take=function(e,t,n){return t!=null&&!n?u.call(e,0,t):e[0]},T.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))},T.last=function(e,t,n){return t!=null&&!n?u.call(e,Math.max(e.length-t,0)):e[e.length-1]},T.rest=T.tail=T.drop=function(e,t,n){return u.call(e,t==null||n?1:t)},T.compact=function(e){return T.filter(e,function(e){return!!e})};var A=function(e,t,n){return N(e,function(e){T.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n};T.flatten=function(e,t){return A(e,t,[])},T.without=function(e){return T.difference(e,u.call(arguments,1))},T.uniq=T.unique=function(e,t,n,r){var i=n?T.map(e,n,r):e,s=[],o=[];return N(i,function(n,r){if(t?!r||o[o.length-1]!==n:!T.contains(o,n))o.push(n),s.push(e[r])}),s},T.union=function(){return T.uniq(a.apply(r,arguments))},T.intersection=function(e){var t=u.call(arguments,1);return T.filter(T.uniq(e),function(e){return T.every(t,function(t){return T.indexOf(t,e)>=0})})},T.difference=function(e){var t=a.apply(r,u.call(arguments,1));return T.filter(e,function(e){return!T.contains(t,e)})},T.zip=function(){var e=u.call(arguments),t=T.max(T.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=T.pluck(e,""+r);return n},T.object=function(e,t){var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},T.indexOf=function(e,t,n){var r=0,i=e.length;if(n){if(typeof n!="number")return r=T.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(b&&e.indexOf===b)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},T.lastIndexOf=function(e,t,n){var r=n!=null;if(w&&e.lastIndexOf===w)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},T.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var O=function(){};T.bind=function(t,n){var r,i;if(t.bind===x&&x)return x.apply(t,u.call(arguments,1));if(!T.isFunction(t))throw new TypeError;return i=u.call(arguments,2),r=function(){if(this instanceof r){O.prototype=t.prototype;var e=new O,s=t.apply(e,i.concat(u.call(arguments)));return Object(s)===s?s:e}return t.apply(n,i.concat(u.call(arguments)))}},T.bindAll=function(e){var t=u.call(arguments,1);return t.length==0&&(t=T.functions(e)),N(t,function(t){e[t]=T.bind(e[t],e)}),e},T.memoize=function(e,t){var n={};return t||(t=T.identity),function(){var r=t.apply(this,arguments);return T.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},T.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},T.defer=function(e){return T.delay.apply(T,[e,1].concat(u.call(arguments,1)))},T.throttle=function(e,t){var n,r,i,s,o,u,a=T.debounce(function(){o=s=!1},t);return function(){n=this,r=arguments;var f=function(){i=null,o&&(u=e.apply(n,r)),a()};return i||(i=setTimeout(f,t)),s?o=!0:(s=!0,u=e.apply(n,r)),a(),u}},T.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},T.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},T.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},T.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},T.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},T.keys=S||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)T.has(e,n)&&(t[t.length]=n);return t},T.values=function(e){var t=[];for(var n in e)T.has(e,n)&&t.push(e[n]);return t},T.pairs=function(e){var t=[];for(var n in e)T.has(e,n)&&t.push([n,e[n]]);return t},T.invert=function(e){var t={};for(var n in e)T.has(e,n)&&(t[e[n]]=n);return t},T.functions=T.methods=function(e){var t=[];for(var n in e)T.isFunction(e[n])&&t.push(n);return t.sort()},T.extend=function(e){return N(u.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},T.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return N(n,function(n){n in e&&(t[n]=e[n])}),t},T.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)T.contains(n,i)||(t[i]=e[i]);return t},T.defaults=function(e){return N(u.call(arguments,1),function(t){for(var n in t)e[n]==null&&(e[n]=t[n])}),e},T.clone=function(e){return T.isObject(e)?T.isArray(e)?e.slice():T.extend({},e):e},T.tap=function(e,t){return t(e),e};var M=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof T&&(e=e._wrapped),t instanceof T&&(t=t._wrapped);var i=l.call(e);if(i!=l.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,u=!0;if(i=="[object Array]"){o=e.length,u=o==t.length;if(u)while(o--)if(!(u=M(e[o],t[o],n,r)))break}else{var a=e.constructor,f=t.constructor;if(a!==f&&!(T.isFunction(a)&&a instanceof a&&T.isFunction(f)&&f instanceof f))return!1;for(var c in e)if(T.has(e,c)){o++;if(!(u=T.has(t,c)&&M(e[c],t[c],n,r)))break}if(u){for(c in t)if(T.has(t,c)&&!(o--))break;u=!o}}return n.pop(),r.pop(),u};T.isEqual=function(e,t){return M(e,t,[],[])},T.isEmpty=function(e){if(e==null)return!0;if(T.isArray(e)||T.isString(e))return e.length===0;for(var t in e)if(T.has(e,t))return!1;return!0},T.isElement=function(e){return!!e&&e.nodeType===1},T.isArray=E||function(e){return l.call(e)=="[object Array]"},T.isObject=function(e){return e===Object(e)},N(["Arguments","Function","String","Number","Date","RegExp"],function(e){T["is"+e]=function(t){return l.call(t)=="[object "+e+"]"}}),T.isArguments(arguments)||(T.isArguments=function(e){return!!e&&!!T.has(e,"callee")}),typeof /./!="function"&&(T.isFunction=function(e){return typeof e=="function"}),T.isFinite=function(e){return T.isNumber(e)&&isFinite(e)},T.isNaN=function(e){return T.isNumber(e)&&e!=+e},T.isBoolean=function(e){return e===!0||e===!1||l.call(e)=="[object Boolean]"},T.isNull=function(e){return e===null},T.isUndefined=function(e){return e===void 0},T.has=function(e,t){return c.call(e,t)},T.noConflict=function(){return e._=t,this},T.identity=function(e){return e},T.times=function(e,t,n){for(var r=0;r<e;r++)t.call(n,r)},T.random=function(e,t){return t==null&&(t=e,e=0),e+(0|Math.random()*(t-e+1))};var _={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};_.unescape=T.invert(_.escape);var D={escape:new RegExp("["+T.keys(_.escape).join("")+"]","g"),unescape:new RegExp("("+T.keys(_.unescape).join("|")+")","g")};T.each(["escape","unescape"],function(e){T[e]=function(t){return t==null?"":(""+t).replace(D[e],function(t){return _[e][t]})}}),T.result=function(e,t){if(e==null)return null;var n=e[t];return T.isFunction(n)?n.call(e):n},T.mixin=function(e){N(T.functions(e),function(t){var n=T[t]=e[t];T.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),F.call(this,n.apply(T,e))}})};var P=0;T.uniqueId=function(e){var t=P++;return e?e+t:t},T.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var H=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;T.template=function(e,t,n){n=T.defaults({},n,T.templateSettings);var r=new RegExp([(n.escape||H).source,(n.interpolate||H).source,(n.evaluate||H).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(t,n,r,o,u){s+=e.slice(i,u).replace(j,function(e){return"\\"+B[e]}),s+=n?"'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?"'+\n((__t=("+r+"))==null?'':__t)+\n'":o?"';\n"+o+"\n__p+='":"",i=u+t.length}),s+="';\n",n.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=new Function(n.variable||"obj","_",s)}catch(u){throw u.source=s,u}if(t)return o(t,T);var a=function(e){return o.call(this,e,T)};return a.source="function("+(n.variable||"obj")+"){\n"+s+"}",a},T.chain=function(e){return T(e).chain()};var F=function(e){return this._chain?T(e).chain():e};T.mixin(T),N(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];T.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],F.call(this,n)}}),N(["concat","join","slice"],function(e){var t=r[e];T.prototype[e]=function(){return F.call(this,t.apply(this._wrapped,arguments))}}),T.extend(T.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),typeof define=="function"&&define.amd&&define("underscore",[],function(){return T})}.call(this),function(e,t){typeof exports!="undefined"&&typeof process!="undefined"?t(e,exports,require("underscore")):typeof define=="function"&&define.amd?define("backbone",["underscore","jquery","exports"],function(n,r,i){e.Backbone=t(e,i,n,r)}):e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender)}(this,function(e,t,n,r){var i=e.Backbone,s=Array.prototype.slice,o=Array.prototype.splice;t.VERSION="0.9.2",t.setDomLibrary=function(e){r=e},t.noConflict=function(){return e.Backbone=i,t},t.emulateHTTP=!1,t.emulateJSON=!1;var u=/\s+/,a=t.Events={on:function(e,t,n){var r,i,s,o,a;if(!t)return this;e=e.split(u),r=this._callbacks||(this._callbacks={});while(i=e.shift())a=r[i],s=a?a.tail:{},s.next=o={},s.context=n,s.callback=t,r[i]={tail:o,next:a?a.next:s};return this},off:function(e,t,r){var i,s,o,a,f,l;if(!(s=this._callbacks))return;if(!(e||t||r))return delete this._callbacks,this;e=e?e.split(u):n.keys(s);while(i=e.shift()){o=s[i],delete s[i];if(!o||!t&&!r)continue;a=o.tail;while((o=o.next)!==a)f=o.callback,l=o.context,(t&&f!==t||r&&l!==r)&&this.on(i,f,l)}return this},trigger:function(e){var t,n,r,i,o,a,f;if(!(r=this._callbacks))return this;a=r.all,e=e.split(u),f=s.call(arguments,1);while(t=e.shift()){if(n=r[t]){i=n.tail;while((n=n.next)!==i)n.callback.apply(n.context||this,f)}if(n=a){i=n.tail,o=[t].concat(f);while((n=n.next)!==i)n.callback.apply(n.context||this,o)}}return this}};a.bind=a.on,a.unbind=a.off;var f=t.Model=function(e,t){var r;e||(e={}),t&&t.parse&&(e=this.parse(e));if(r=C(this,"defaults"))e=n.extend({},r,e);t&&t.collection&&(this.collection=t.collection),this.attributes={},this._escapedAttributes={},this.cid=n.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(e,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=n.clone(this.attributes),this.initialize.apply(this,arguments)};n.extend(f.prototype,a,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},get:function(e){return this.attributes[e]},escape:function(e){var t;if(t=this._escapedAttributes[e])return t;var r=this.get(e);return this._escapedAttributes[e]=n.escape(r==null?"":""+r)},has:function(e){return this.get(e)!=null},set:function(e,t,r){var i,s,o;n.isObject(e)||e==null?(i=e,r=t):(i={},i[e]=t),r||(r={});if(!i)return this;i instanceof f&&(i=i.attributes);if(r.unset)for(s in i)i[s]=void 0;if(!this._validate(i,r))return!1;this.idAttribute in i&&(this.id=i[this.idAttribute]);var u=r.changes={},a=this.attributes,l=this._escapedAttributes,c=this._previousAttributes||{};for(s in i){o=i[s];if(!n.isEqual(a[s],o)||r.unset&&n.has(a,s))delete l[s],(r.silent?this._silent:u)[s]=!0;r.unset?delete a[s]:a[s]=o,!n.isEqual(c[s],o)||n.has(a,s)!=n.has(c,s)?(this.changed[s]=o,r.silent||(this._pending[s]=!0)):(delete this.changed[s],delete this._pending[s])}return r.silent||this.change(r),this},unset:function(e,t){return(t||(t={})).unset=!0,this.set(e,null,t)},clear:function(e){return(e||(e={})).unset=!0,this.set(n.clone(this.attributes),e)},fetch:function(e){e=e?n.clone(e):{};var r=this,i=e.success;return e.success=function(t,n,s){if(!r.set(r.parse(t,s),e))return!1;i&&i(r,t)},e.error=t.wrapError(e.error,r,e),(this.sync||t.sync).call(this,"read",this,e)},save:function(e,r,i){var s,o;n.isObject(e)||e==null?(s=e,i=r):(s={},s[e]=r),i=i?n.clone(i):{};if(i.wait){if(!this._validate(s,i))return!1;o=n.clone(this.attributes)}var u=n.extend({},i,{silent:!0});if(s&&!this.set(s,i.wait?u:i))return!1;var a=this,f=i.success;i.success=function(e,t,r){var o=a.parse(e,r);i.wait&&(delete i.wait,o=n.extend(s||{},o));if(!a.set(o,i))return!1;f?f(a,e):a.trigger("sync",a,e,i)},i.error=t.wrapError(i.error,a,i);var l=this.isNew()?"create":"update",c=(this.sync||t.sync).call(this,l,this,i);return i.wait&&this.set(o,u),c},destroy:function(e){e=e?n.clone(e):{};var r=this,i=e.success,s=function(){r.trigger("destroy",r,r.collection,e)};if(this.isNew())return s(),!1;e.success=function(t){e.wait&&s(),i?i(r,t):r.trigger("sync",r,t,e)},e.error=t.wrapError(e.error,r,e);var o=(this.sync||t.sync).call(this,"delete",this,e);return e.wait||s(),o},url:function(){var e=C(this,"urlRoot")||C(this.collection,"url")||k();return this.isNew()?e:e+(e.charAt(e.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(e){e||(e={});var t=this._changing;this._changing=!0;for(var r in this._silent)this._pending[r]=!0;var i=n.extend({},e.changes,this._silent);this._silent={};for(var r in i)this.trigger("change:"+r,this,this.get(r),e);if(t)return this;while(!n.isEmpty(this._pending)){this._pending={},this.trigger("change",this,e);for(var r in this.changed){if(this._pending[r]||this._silent[r])continue;delete this.changed[r]}this._previousAttributes=n.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(e){return arguments.length?n.has(this.changed,e):!n.isEmpty(this.changed)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t,r=!1,i=this._previousAttributes;for(var s in e){if(n.isEqual(i[s],t=e[s]))continue;(r||(r={}))[s]=t}return r},previous:function(e){return!arguments.length||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return n.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(e,t){if(t.silent||!this.validate)return!0;e=n.extend({},this.attributes,e);var r=this.validate(e,t);return r?(t&&t.error?t.error(this,r,t):this.trigger("error",this,r,t),!1):!0}});var l=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,{silent:!0,parse:t.parse})};n.extend(l.prototype,a,{model:f,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},add:function(e,t){var r,i,s,u,a,f,l={},c={},h=[];t||(t={}),e=n.isArray(e)?e.slice():[e];for(r=0,s=e.length;r<s;r++){if(!(u=e[r]=this._prepareModel(e[r],t)))throw new Error("Can't add an invalid model to a collection");a=u.cid,f=u.id;if(l[a]||this._byCid[a]||f!=null&&(c[f]||this._byId[f])){h.push(r);continue}l[a]=c[f]=u}r=h.length;while(r--)e.splice(h[r],1);for(r=0,s=e.length;r<s;r++)(u=e[r]).on("all",this._onModelEvent,this),this._byCid[u.cid]=u,u.id!=null&&(this._byId[u.id]=u);this.length+=s,i=t.at!=null?t.at:this.models.length,o.apply(this.models,[i,0].concat(e)),this.comparator&&this.sort({silent:!0});if(t.silent)return this;for(r=0,s=this.models.length;r<s;r++){if(!l[(u=this.models[r]).cid])continue;t.index=r,u.trigger("add",u,this,t)}return this},remove:function(e,t){var r,i,s,o;t||(t={}),e=n.isArray(e)?e.slice():[e];for(r=0,i=e.length;r<i;r++){o=this.getByCid(e[r])||this.get(e[r]);if(!o)continue;delete this._byId[o.id],delete this._byCid[o.cid],s=this.indexOf(o),this.models.splice(s,1),this.length--,t.silent||(t.index=s,o.trigger("remove",o,this,t)),this._removeReference(o)}return this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,t),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,n.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},get:function(e){return e==null?void 0:this._byId[e.id!=null?e.id:e]},getByCid:function(e){return e&&this._byCid[e.cid||e]},at:function(e){return this.models[e]},where:function(e){return n.isEmpty(e)?[]:this.filter(function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},sort:function(e){e||(e={});if(!this.comparator)throw new Error("Cannot sort a set without a comparator");var t=n.bind(this.comparator,this);return this.comparator.length==1?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("reset",this,e),this},pluck:function(e){return n.map(this.models,function(t){return t.get(e)})},reset:function(e,t){e||(e=[]),t||(t={});for(var r=0,i=this.models.length;r<i;r++)this._removeReference(this.models[r]);return this._reset(),this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},fetch:function(e){e=e?n.clone(e):{},e.parse===undefined&&(e.parse=!0);var r=this,i=e.success;return e.success=function(t,n,s){r[e.add?"add":"reset"](r.parse(t,s),e),i&&i(r,t)},e.error=t.wrapError(e.error,r,e),(this.sync||t.sync).call(this,"read",this,e)},create:function(e,t){var r=this;t=t?n.clone(t):{},e=this._prepareModel(e,t);if(!e)return!1;t.wait||r.add(e,t);var i=t.success;return t.success=function(n,s,o){t.wait&&r.add(n,t),i?i(n,s):n.trigger("sync",e,s,t)},e.save(null,t),e},parse:function(e,t){return e},chain:function(){return n(this.models).chain()},_reset:function(e){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(e,t){t||(t={});if(e instanceof f)e.collection||(e.collection=this);else{var n=e;t.collection=this,e=new this.model(n,t),e._validate(e.attributes,t)||(e=!1)}return e},_removeReference:function(e){this==e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e=="add"||e=="remove")&&n!=this)return;e=="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],this._byId[t.id]=t),this.trigger.apply(this,arguments)}});var c=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];n.each(c,function(e){l.prototype[e]=function(){return n[e].apply(n,[this.models].concat(n.toArray(arguments)))}});var h=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},p=/:\w+/g,d=/\*\w+/g,v=/[-[\]{}()+?.,\\^$|#\s]/g;n.extend(h.prototype,a,{initialize:function(){},route:function(e,r,i){return t.history||(t.history=new m),n.isRegExp(e)||(e=this._routeToRegExp(e)),i||(i=this[r]),t.history.route(e,n.bind(function(n){var s=this._extractParameters(e,n);i&&i.apply(this,s),this.trigger.apply(this,["route:"+r].concat(s)),t.history.trigger("route",this,r,s)},this)),this},navigate:function(e,n){t.history.navigate(e,n)},_bindRoutes:function(){if(!this.routes)return;var e=[];for(var t in this.routes)e.unshift([t,this.routes[t]]);for(var n=0,r=e.length;n<r;n++)this.route(e[n][0],e[n][1],this[e[n][1]])},_routeToRegExp:function(e){return e=e.replace(v,"\\$&").replace(p,"([^/]+)").replace(d,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var m=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl")},g=/^[#\/]/,y=/msie [\w.]+/;m.started=!1,n.extend(m.prototype,a,{interval:50,getHash:function(e){var t=e?e.location:window.location,n=t.href.match(/#(.*)$/);return n?n[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||t){e=window.location.pathname;var n=window.location.search;n&&(e+=n)}else e=this.getHash();return e.indexOf(this.options.root)||(e=e.substr(this.options.root.length)),e.replace(g,"")},start:function(e){if(m.started)throw new Error("Backbone.history has already been started");m.started=!0,this.options=n.extend({},{root:"/"},this.options,e),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var t=this.getFragment(),i=document.documentMode,s=y.exec(navigator.userAgent.toLowerCase())&&(!i||i<=7);s&&(this.iframe=r('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?r(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?r(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var o=window.location,u=o.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!u)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&u&&o.hash&&(this.fragment=this.getHash().replace(g,""),window.history.replaceState({},document.title,o.protocol+"//"+o.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},stop:function(){r(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),m.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t==this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t==this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),r=n.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return r},navigate:function(e,t){if(!m.started)return!1;if(!t||t===!0)t={trigger:t};var n=(e||"").replace(g,"");if(this.fragment==n)return;this._hasPushState?(n.indexOf(this.options.root)!=0&&(n=this.options.root+n),this.fragment=n,window.history[t.replace?"replaceState":"pushState"]({},document.title,n)):this._wantsHashChange?(this.fragment=n,this._updateHash(window.location,n,t.replace),this.iframe&&n!=this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,n,t.replace))):window.location.assign(this.options.root+e),t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){n?e.replace(e.toString().replace(/(javascript:|#).*$/,"")+"#"+t):e.hash=t}});var b=t.View=function(e){this.cid=n.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},w=/^(\S+)\s*(.*)$/,E=["model","collection","el","id","attributes","className","tagName"];n.extend(b.prototype,a,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(e,t,n){var i=document.createElement(e);return t&&r(i).attr(t),n!=null&&r(i).html(n),i},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof r?e:r(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=C(this,"events")))return;this.undelegateEvents();for(var t in e){var r=e[t];n.isFunction(r)||(r=this[e[t]]);if(!r)throw new Error('Method "'+e[t]+'" does not exist');var i=t.match(w),s=i[1],o=i[2];r=n.bind(r,this),s+=".delegateEvents"+this.cid,o===""?this.$el.bind(s,r):this.$el.delegate(o,s,r)}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=n.extend({},this.options,e));for(var t=0,r=E.length;t<r;t++){var i=E[t];e[i]&&(this[i]=e[i])}this.options=e},_ensureElement:function(){if(!this.el){var e=C(this,"attributes")||{};this.id&&(e.id=this.id),this.className&&(e["class"]=this.className),this.setElement(this.make(this.tagName,e),!1)}else this.setElement(this.el,!1)}});var S=function(e,t){var n=N(this,e,t);return n.extend=this.extend,n};f.extend=l.extend=h.extend=b.extend=S;var x={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};t.sync=function(e,i,s){var o=x[e];s||(s={});var u={type:o,dataType:"json"};return s.url||(u.url=C(i,"url")||k()),!s.data&&i&&(e=="create"||e=="update")&&(u.contentType="application/json",u.data=JSON.stringify(i.toJSON())),t.emulateJSON&&(u.contentType="application/x-www-form-urlencoded",u.data=u.data?{model:u.data}:{}),t.emulateHTTP&&(o==="PUT"||o==="DELETE")&&(t.emulateJSON&&(u.data._method=o),u.type="POST",u.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",o)}),u.type!=="GET"&&!t.emulateJSON&&(u.processData=!1),r.ajax(n.extend(u,s))},t.wrapError=function(e,t,n){return function(r,i){i=r===t?i:r,e?e(t,i,n):t.trigger("error",t,i,n)}};var T=function(){},N=function(e,t,r){var i;return t&&t.hasOwnProperty("constructor")?i=t.constructor:i=function(){e.apply(this,arguments)},n.extend(i,e),T.prototype=e.prototype,i.prototype=new T,t&&n.extend(i.prototype,t),r&&n.extend(i,r),i.prototype.constructor=i,i.__super__=e.prototype,i},C=function(e,t){return!e||!e[t]?null:n.isFunction(e[t])?e[t]():e[t]},k=function(){throw new Error('A "url" property or function must be specified')};return t}),function(){function e(t,n){var r=t.cssRules||t.rules||[];for(var i=0;i<r.length;i++){var s=r[i];s.type==CSSRule.IMPORT_RULE?e(s.styleSheet,n):(s.type===CSSRule.KEYFRAMES_RULE||s.type===CSSRule.WEBKIT_KEYFRAMES_RULE)&&n(s,t,i)}}function t(e){this.original=e,this.keyText=e.keyText,this.css={};var t=e.style.cssText.split(";");for(var n=0;n<t.length;n++){var r=t[n].split(":");if(r.length==2){var i=r[0].replace(/^\s+|\s+$/g,""),s=r[1].replace(/^\s+|\s+$/g,"");this.css[i]=s}}}function n(e){this.original=e,this.name=e.name,this.keyframes=[],this.keytexts=[],this.keyframeHash={},this.initKeyframes()}function r(){this.animations={};var t=document.styleSheets,r=this.animations;for(var i=0;i<t.length;i++)try{e(t[i],function(e){r[e.name]=new n(e)})}catch(s){}}n.prototype.initKeyframes=function(){this.keyframes=[],this.keytexts=[],this.keyframeHash={};var e=this.original;for(var n=0;n<e.cssRules.length;n++){var r=new t(e.cssRules[n]);this.keyframes.push(r),this.keytexts.push(r.keyText),this.keyframeHash[r.keyText]=r}},n.prototype.getKeyframeTexts=function(){return this.keytexts},n.prototype.getKeyframe=function(e){return this.keyframeHash[e]},n.prototype.setKeyframe=function(e,t){var n=e+" {";for(var r in t)n+=r+":"+t[r]+";";n+="}",this.original.insertRule(n),this.initKeyframes()},n.prototype.clear=function(){for(var e=0;e<this.keyframes.length;e++)this.original.deleteRule(this.keyframes[e].keyText)},r.prototype.get=function(e){return this.animations[e]},r.prototype.getDynamicSheet=function(){if(!this.dynamicSheet){var e=document.createElement("style");e.rel="stylesheet",e.type="text/css",document.getElementsByTagName("head")[0].appendChild(e),this.dynamicSheet=e.sheet}return this.dynamicSheet},r.prototype.create=function(e){var t=this.getDynamicSheet();e||(e="anim"+Math.floor(Math.random()*1e5));try{var r=t.insertRule("@keyframes "+e+"{}",t.cssRules.length)}catch(i){if(i.name!="SYNTAX_ERR")throw i;r=t.insertRule("@-webkit-keyframes "+e+"{}",t.cssRules.length)}return this.animations[e]=new n(t.cssRules[r]),this.animations[e]},r.prototype.remove=function(t){var r=this.getDynamicSheet();t=t instanceof n?t.name:t,this.animations[t]=null;try{e(r,function(e,n,r){e.name==t&&n.deleteRule(r)})}catch(i){}},typeof define=="function"&&define.amd?define("layouts/css-animations",[],function(){return new r}):window.CSSAnimations=new r}(),define("layouts/anim",["require","zepto","./css-animations"],function(e){function i(e,t,n){return n=n||{},n["-webkit-"+e]=t,n["-moz-"+e]=t,n["-ms-"+e]=t,n["-o-"+e]=t,n[e]=t,n}function s(e,n,r){e=t(e);var i=["","webkit","moz","ms","o"];for(var s in i)(function(t){e.on(t+n,function(){r(),e.off(t+n)})})(i[s])}function o(e,t,n,r,s){a(e,i("transform","translateX("+Math.floor(t)+"px)"),i("transform","translateX("+Math.floor(n)+"px)"),r,s)}function u(e,t,n,r,s){a(e,i("transform","translateY("+Math.floor(t)+"px)"),i("transform","translateY("+Math.floor(n)+"px)"),r,s)}function a(e,o,u,a,f){e=t(e);var l=n.create();l.setKeyframe("0%",o),l.setKeyframe("100%",u),e.css(i("animation-duration",a,i("animation-name",l.name,{"z-index":r++}))),s(e,"animationend",function(){f&&e.css({zIndex:0}),n.remove(l)})}function f(e,n){t(n).css(i("transition","none",{zIndex:r++}))}function l(e,n){t(n).css(i("transition","none",{zIndex:0}))}function c(e,n){o(e,0,-t(e).width(),"500ms"),o(n,t(n).width(),0,"500ms")}function h(e,t){c(t,e)}function p(e,n){o(e,0,t(e).width(),"500ms"),o(n,-t(n).width(),0,"500ms")}function d(e,t){p(t,e)}function v(e,n){u(n,-t(n).height(),0,"500ms")}function m(e,n){u(n,0,t(n).height(),"500ms",!0)}function g(e,n){u(n,t(n).height(),0,"500ms")}function y(e,n){u(n,0,-t(n).height(),"500ms",!0)}function b(e,n){var o=t('<div class="anim-background"></div>');o.css({zIndex:r++}),o.insertBefore(n),a(e,i("transform","rotate3d(0, 1, 0, 0deg)"),i("transform","rotate3d(0, 1, 0, 180deg)"),"1s"),a(n,i("transform","rotate3d(0, 1, 0, 180deg)"),i("transform","rotate3d(0, 1, 0, 0deg)"),"1s"),s(n,"animationend",function(){o.remove()})}function w(e,t){b(t,e)}var t=e("zepto"),n=e("./css-animations"),r=100;return{instant:f,instantOut:l,slideLeft:c,slideLeftOut:h,slideRight:p,slideRightOut:d,slideDown:v,slideDownOut:m,slideUp:g,slideUpOut:y,flip:b,flipOut:w}}),define("layouts/header",["require","zepto"],function(e){function n(e){this.parent=e;var n=t(e.el).children("header"),r=t("h1",n),i=n.children(),s=i.get().indexOf(r.get(0)),o='<div class="navitems"></div>';r.css({position:"absolute",top:0,left:0});var u=i.slice(0,s),a=t(o).addClass("left");u.length?u.wrapAll(a):n.prepend(a);var f=i.slice(s+1,i.length),l=t(o).addClass("right");f.length?f.wrapAll(l):n.append(l),n.find("button").click(function(){var n=t(this);if(n.data("view")){var r=t(n.data("view")).get(0);r.open(e.model,n.data("animation"))}}),this.text=t(r).text(),this.el=n.get(0)}var t=e("zepto");return n.prototype.addBack=function(){var e=t(".navitems.left",this.el),n=this;if(!e.children().length){var r=t('<button class="back">Back</button>');e.append(r),r.click(function(){n.parent.close()})}},n.prototype.removeBack=function(){t(".navitems.left button.back",this.el).remove()},n.prototype.setTitle=function(e){this.text=e;var n=t(this.el),r=n.children("h1"),i=n.children(".navitems.left").width(),s=n.children(".navitems.right").width(),o=Math.max(i,s),u=n.width()-o*2;e.length>14&&(e=e.slice(0,11)+"..."),r.text(e),r.css({left:o,width:u,fontSize:"20pt"})},n.prototype.getTitle=function(){return this.text},n}),define("layouts/footer",["require","zepto"],function(e){function n(e){this.parent=e;var n=t(e.el).children("footer"),r=this;t("button",n).each(function(){var e=t(this),n=e.data("view");n&&e.click(function(){r.openView(n,e.data("push")=="true",e.data("animation"))})}),this.el=n.get(0)}var t=e("zepto");return n.prototype.openView=function(e,n,r){var i=t(e).get(0);if(i){var s=i.view,o=s.parent&&s.parent.el;s.parent.manualLayout||(n||!o||o.contains(this.parent.el)&&o!=this.parent.el?s.open(null,r):s.openAlone())}},n}),define("layouts/view",["require","zepto","underscore","backbone","./anim","./header","./footer"],function(e){function u(){this._stack=[],this.manualLayout=!0,this.stackSize=function(){return this._stack.length},this.clearStack=function(){var e=this._stack;while(e.length)e[e.length-1].close()}}var t=e("zepto"),n=e("underscore"),r=e("backbone"),i=e("./anim"),s=e("./header"),o=e("./footer"),a=r.View.extend({initialize:function(){this.initView()},initView:function(){var e=t(this.el);this._stack=[],this.manualLayout=e.data("layout")=="manual",this.anim=e.data("animation");var n=e.parent().get(0);n.view||n.proxyView?this.parent=n.view||n.proxyView:n.view=this.parent=new u,this.initMarkup()},initMarkup:function(){var e=t(this.el);e.children("header").length&&(this.header=new s(this),e.children("header").remove()),e.children("footer").length&&(this.footer=new o(this),e.children("footer").remove());var n=Array.prototype.slice.call(e[0].childNodes),r=t(n);this.manualLayout?(r.length?r.wrapAll('<div class="_contents"></div>'):e.append('<div class="_contents"></div>'),e.children("._contents").get(0).proxyView=this):(r.length?(r.wrapAll('<div class="contents"></div>'),e.children(".contents").wrap('<div class="_contents"></div>')):e.append('<div class="_contents"><div class="contents"></div></div>'),e.children("._contents").children(".contents").get(0).proxyView=this),this.header&&e.prepend(this.header.el),this.footer&&e.append(this.footer.el),this.onResize()},onResize:function(){var e=t(this.el),n=e.children("header").height()+e.children("footer").height();e.children("._contents").css({height:e.height()-n}),this.header&&this.header.setTitle(this.header.getTitle())},stackSize:function(){return this._stack.length},clearStack:function(){var e=this._stack;while(e.length)e[e.length-1].close()},setTitle:function(){if(!this.header)return;var e=this.options.titleField||"title",t=this.model,n;this.getTitle?n=this.getTitle(t):t&&t.get(e)?n=t.get(e):n=this.header.getTitle(),this.header.setTitle(n)},open:function(e,t){t=t||this.anim||"slideLeft",this.lastAnimation=t;var r=this.parent._stack;if(r.indexOf(this.el)!==-1)return;if(i[t]){var s=r.length,o=null;s&&(o=r[s-1]),i[t](o,this.el)}else console.log("WARNING: invalid animation: "+t);r.length&&this.header?this.header.addBack(this):this.header&&this.header.removeBack(),r.push(this.el),this.model=e,this.setTitle(),this.model&&this.model.on("change",n.bind(this.render,this)),this.render(),this.onOpen&&this.onOpen(this)},openAlone:function(e,t){t=t||"instant",i[t]?i[t](null,this.el):console.log("WARNING: invalid animation: "+t),this.header&&this.header.removeBack(),this.model=e,this.setTitle(),this.render(),this.onOpen&&this.onOpen(this)},close:function(e){if(!e)switch(this.lastAnimation){case"slideLeft":e="slideRightOut";break;case"slideRight":e="slideLeftOut";break;case"slideUp":e="slideDownOut";break;case"slideDown":e="slideUpOut";break;default:e="slideRightOut"}var t=this.parent._stack,n=t.length;n>1&&(t[n-1]==this.el&&t.pop(),i[e](t[n-2],this.el),this.model=null)},render:function(){var e=this.model;this.options.render&&this.options.render.call(this.el,e)}});return a}),define("layouts/list",["require","zepto","underscore","backbone","./view"],function(e){var t=e("zepto"),n=e("underscore"),r=e("backbone"),i=e("./view"),s=r.Model.extend({}),o=r.Collection.extend({model:s}),u=i.extend({initialize:function(){this.initView(),this.collection.bind("add",n.bind(this.appendItem,this)),this.collection.bind("reset",n.bind(this.render,this)),t(".contents",this.el).append('<ul class="_list"></ul>'),this.render()},render:function(){t("._list",this.el).html(""),n.each(this.collection.models,function(e){this.appendItem(e)},this)},appendItem:function(e){var n=new a({model:e,titleField:this.options.titleField,render:this.options.renderRow,nextView:this.options.nextView,parent:this});t("._list",this.el).append(n.render().el)}}),a=r.View.extend({tagName:"li",events:{click:"open"},initialize:function(){this.model.on("change",n.bind(this.render,this))},render:function(){var e=this.model,t=this.options.titleField||"title";return this.options.render?this.options.render.call(this.el,e):e.get(t)?this.el.innerHTML=e.get(t):console.log('[ListViewRow] WARNING: item does not have a "title" field, the titleField property is not set, and no custom render function is set'),this},open:function(){var e=this.options,n=e.nextView||"x-view.detail",r=t(n).get(0);r&&r.open(this.model)}});return u.defaultListType=o,u}),define("layouts/layouts",["require","zepto","x-tag","./view","./list"],function(e){function s(e){var n=e.view;t(e).data("first")=="true"?(n.parent.clearStack(),n.open(null,"instant")):n.parent.stackSize()||n.open(null,"instant")}var t=e("zepto"),n=e("x-tag"),r=e("./view"),i=e("./list");return n.domready=!1,n.register("x-view",{onCreate:function(){this.view=new r({el:this}),s(this)},getters:{model:function(){return this.view.model}},setters:{titleField:function(e){this.view.options.titleField=e},render:function(e){this.view.options.render=e},getTitle:function(e){this.view.getTitle=function(t){return e.call(this.el,t)}},model:function(e){this.view.model=e},onOpen:function(e){this.view.onOpen=e}},methods:{open:function(e,t){this.view.open(e,t)},close:function(e){this.view.close(e)}}}),n.register("x-listview",{onCreate:function(){this.view=new i({el:this,collection:new i.defaultListType}),s(this)},getters:{collection:function(){return this.view.collection}},setters:{titleField:function(e){this.view.opts.titleField=e},renderRow:function(e){this.view.options.renderRow=e},nextView:function(e){this.view.options.nextView=e},collection:function(e){this.view.collection=e},onOpen:function(e){this.view.onOpen=e}},methods:{add:function(e){this.view.collection.add(e)},open:function(e,t){this.view.open(e,t)},close:function(e){this.view.close(e)}}}),n.domready=!0,n.query(document,n.tagList).forEach(function(e){n.tagCheck(e)&&(n.extendElement(e),document.documentElement.contains(e)&&n.getOptions(e).onInsert.call(e))}),window.onresize=function(){var e="x-view, x-listview";t(e).each(function(){this.view.onResize()})},{BasicView:r,ListView:i}}),define("../app",["require","receiptverifier","./install-button","layouts/layouts"],function(e){function t(e){return e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear()}e("receiptverifier"),e("./install-button"),e("layouts/layouts");var n=$(".list").get(0);n.add({title:"Learn this template",desc:'This is a list-detail template. Learn more about it at its <a href="https://github.com/mozilla/mortar-list-detail">project page!</a>',date:new Date}),n.add({title:"Make things",desc:"Make this look like that",date:new Date(12,9,5)}),n.add({title:"Move stuff",desc:"Move this over there",date:new Date(12,10,1)}),$("button.refresh",n).click(function(){});var r=$(".detail").get(0);r.render=function(e){$(".title",this).html(e.get("title")),$(".desc",this).html(e.get("desc")),$(".date",this).text(t(e.get("date")))};var i=$(".edit").get(0);i.render=function(e){e=e||{id:"",get:function(){return""}},$("input[name=id]",this).val(e.id),$("input[name=title]",this).val(e.get("title")),$("input[name=desc]",this).val(e.get("desc"))},i.getTitle=function(){var e=this.view.model;return e?e.get("title"):"New"},$("button.add",i).click(function(){var e=$(i),t=e.find("input[name=title]"),r=e.find("input[name=desc]"),s=i.model;s?s.set({title:t.val(),desc:r.val()}):n.add({title:t.val(),desc:r.val(),date:new Date}),i.close()})})